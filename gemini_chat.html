<!DOCTYPE html>
<html>
<head>
    <title>ç»³å¢¨</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: sans-serif;
            background-color: #121212;
            color: #c0c0c0;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            font-size: 1.5em;
            -webkit-tap-highlight-color: transparent;
        }

        .std-button {
            color: #e0c2a3;
            background-color: #3a3a3a;
            border: 1px solid #e0c2a3;
            border-radius: 5px;
            text-align: center;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 36px;
            height: 36px;
            line-height: normal;
            z-index: 5;
            cursor: pointer;
            user-select: none;
        }

        .std-button.role-state-active {
            background-color: green;
        }

        .std-button.edit-disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }


        #chat-container {
            width: 100%;
            max-width: 600px;
            background-color: inherit;
            display: flex;
            flex-direction: column;
            height: 100vh;
            margin: 0;
            position: relative;
            overflow: hidden;
            background-size: auto 100vh;
            background-position: center center;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }

        #top-toolbar {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 36px;
            display: flex;
            align-items: center;
            z-index: 5;
            background-color: transparent;
            box-sizing: border-box;
            padding: 0;
        }

        #settings-icon {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 11;
            background-color: transparent;
        }

        #novel-button {
            position: absolute;
            top: 0;
            right: 75px;
            z-index: 9;
            background-color: transparent;
        }


        #role-button {
            margin-left: 36px;
            background-color: transparent;
        }
        #rule-button {
             margin-left: 0;
             background-color: transparent;
        }

        #add-admin-button {
             background-color: transparent;
             margin-left: 5px;
        }

        #run-pause-button {
            background-color: transparent;
        }

        #loading-spinner {
            display: none;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, calc(-50% + 5px));
            width: 24px;
            height: 24px;
            border: 3px solid rgba(224, 194, 163, 0.3);
            border-radius: 50%;
            border-top-color: #e0c2a3;
            z-index: 6;
        }

        #loading-spinner.spinning {
            animation: spin 1s linear infinite;
        }

        #loading-spinner.retry-indicator {
             border-top-color: red;
        }

        @keyframes spin {
            to {
                transform: translate(-50%, calc(-50% + 5px)) rotate(360deg);
            }
        }


        #role-buttons-wrapper {
            position: absolute;
            top: 36px;
            left: 0;
            right: 0;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            z-index: 5;
            max-height: calc(100vh - 36px);
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #555 #121212;
        }


        #role-buttons-list-container {
            display: none;
            flex-direction: column;
            align-items: flex-start;
            z-index: 6;
        }

        .role-button-container {
            display: flex;
            align-items: center;
            margin-bottom: 0px;
        }

        .role-button-container .std-button {
            margin-right: 0px;
        }

        .role-state-buttons {
            display: none;
        }

        .role-state-buttons.active {
            display: flex;
        }

        .role-state-buttons .std-button {
            margin-left: 0px;
        }

        #active-role-trigger-list {
            position: absolute;
            top: 36px;
            right: 0px;
            width: auto;
            max-width: 150px;
            display: none;
            flex-direction: column;
            align-items: flex-end;
            background-color: #252525;
            border: 1px solid #555;
            border-radius: 0 0 5px 5px;
            z-index: 7;
            padding: 5px;
            gap: 5px;
        }

        .active-role-trigger-button {
            background-color: #3a3a3a;
            color: #e0c2a3;
            border: 1px solid #777;
            border-radius: 3px;
            padding: 5px 8px;
            text-align: center;
            cursor: pointer;
            width: 100%;
            box-sizing: border-box;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 0.9em;
            line-height: 1.2;
            height: auto;
            min-height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #settings-panel,
        .setting-page-template,
        #image-viewer-page {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: inherit;
            z-index: 10;
            overflow-y: auto;
        }



        .setting-page-template.active,
        #settings-panel.active,
        #image-viewer-page.active {
            display: flex;
        }


        .settings-header {
            text-align: center;
            color: #e0c2a3;
            margin-bottom: 8px;
            padding-bottom: 5px;
            border-bottom: 1px solid #333;
            position: relative;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-button {
            position: absolute;
            top: 0;
            right: 0;
        }

        .settings-section {
            box-sizing: border-box;
            width: 100%;
            flex-grow: 1;
            overflow-y: auto;
            padding-bottom: 40px;
        }

        .settings-group {
            margin-bottom: 20px;
            padding: 0 10px;
        }

        .settings-label {
            display: block;
            margin-bottom: 5px;
            color: #ddd;
            font-weight: bold;
        }

        .settings-input,
        .settings-textarea,
        .settings-select,
        .settings-menu-item {
            width: 100%;
            margin-bottom: 10px;
            border: 1px solid #555;
            background-color: #252525;
            color: #f0f0f0;
            box-sizing: border-box;
            padding: 8px 10px;
            cursor: pointer;
            text-align: left;
            border-radius: 5px;
            display: block;
            font-size: 1em;
            font-family: inherit;
        }


        .settings-menu-item:hover {
            background-color: #3a3a3a;
        }

        .settings-textarea {
            height: 100px;
            font-family: monospace;
            font-size: 0.9em;
            white-space: pre-wrap;
            resize: vertical;
        }

        #error-log-display {
            height: 200px;
            font-size: 0.8em;
        }
        #world-info-display {
             height: 150px;
             font-size: 0.8em;
             white-space: pre;
        }
        #novelai-last-prompt-display {
             height: 150px;
             font-size: 0.8em;
             white-space: pre-wrap;
             background-color: #303030;
        }
        #roleplay-rules-textarea {
            height: 150px;
        }
        #public-info-textarea {
            height: 150px;
        }
         #system-instruction-preset-settings,
         #shared-database-instruction-settings,
         #chatroom-main-prompt-settings,
         #drawing-master-main-prompt-settings,
         #game-host-main-prompt-settings,
         #writing-master-main-prompt-settings,
         #character-update-master-main-prompt-settings,
         #private-assistant-main-prompt-settings {
             height: 150px;
         }


        #role-list-container,
        #chatroom-list-container,
        #novel-list-container {
            margin-top: 10px;
        }


        .role-item,
        .chatroom-item,
        .novel-item,

        .prompt-preset-item {
            padding: 8px;
            background-color: #252525;
            color: #f0f0f0;
            margin-bottom: 5px;
            border-radius: 5px;

            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .role-item span,
        .chatroom-item label,
        .novel-item .novel-name,

        .prompt-preset-item .preset-role-label
         {
            margin-left: 8px;
            cursor: pointer;
            flex-grow: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            margin-right: 10px;
        }


        .role-item span { margin-left: 0; }
        .novel-item .novel-name { margin-left: 0; cursor: default; }

        .prompt-preset-item .preset-role-label { margin-left: 0; cursor: default; width: 20px; flex-grow: 0; flex-shrink: 0; text-align: center; font-weight:bold; }
        .prompt-preset-item .preset-instruction-textarea {
            flex-grow: 1;
            height: 60px;
            margin: 0 5px 0 0;
            font-size: 0.9em;
            line-height: 1.3;
            resize: vertical;
            font-family: monospace;
            white-space: pre-wrap;
            border: 1px solid #555;
            background-color: #303030;
            color: #f0f0f0;
            border-radius: 5px;
            padding: 5px;
        }


        .item-actions {
            display: flex;
            gap: 5px;
            flex-shrink: 0;
        }
         .prompt-preset-item .item-actions {
             flex-direction: column;
             gap: 3px;
         }
         .prompt-preset-item .item-actions .std-button {
             width: 24px;
             height: 24px;
             font-size: 0.8em;
         }

        .chatroom-item input[type="radio"] {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            width: 16px;
            height: 16px;
            border: 2px solid #777;
            border-radius: 50%;
            background-color: #252525;
            cursor: pointer;
            position: relative;
            flex-shrink: 0;
            margin-right: 5px;
        }

        .chatroom-item input[type="radio"]:checked {
            border-color: #e0c2a3;
        }

        .chatroom-item input[type="radio"]:checked::after {
            content: '';
            display: block;
            position: absolute;
            top: 3px;
            left: 3px;
            width: 8px;
            height: 8px;
            background-color: #e0c2a3;
            border-radius: 50%;
        }


        #chat-area {
            flex-grow: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            scrollbar-width: none;
            scrollbar-color: auto;
            height: 100%;
            background-color: transparent;
            box-sizing: border-box;
            padding-top: 36px;
            padding-bottom: 60vh;
        }
        #chat-area::-webkit-scrollbar {
             display: none;
        }

        .message-container {
            display: flex;
            flex-direction: column;
            margin: 8px 10px;
            max-width: 95%;
            position: relative;
            order: 1;
        }


        .message-container[data-source-type="user"] {
            align-items: flex-end;
        }
        .message-container:not([data-source-type="user"]) {
            align-items: flex-start;
        }


        .role-name-button-above-bubble {
            margin-bottom: -8px;
            margin-left: 10px;
            z-index: 1;
            align-self: flex-start;
        }

        .message-container[data-source-type="user"] .role-name-button-above-bubble {
            align-self: flex-end;
            margin-right: 10px;
            margin-left: 0px;
        }


        .user-message, .ai-response {
            word-wrap: break-word;
            overflow-wrap: break-word;
            border-radius: 15px;
            padding: 10px;
            z-index: 1;
            position: relative;
            margin-top: 8px;
            white-space: pre-wrap;
            background-color: #FFF2E2;
            color: #000;
            text-align: left;
            max-width: 100%;
            box-sizing: border-box;
        }

        .ai-response img {
            display: block;
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 5px;
        }


        #image-viewer-page {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 101;
            display: none;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            overflow: hidden;
        }
        #image-viewer-page.active {
             display: flex;
        }

        #image-viewer-content {
            display: block;
            height: 100%;
            width: auto;
            max-width: none;
            object-fit: contain;
            margin: auto;
        }


        .message-actions-container {
            display: none;
            position: absolute;
            top: 0;
            align-items: center;
            z-index: 2;
            left: 46px;
            gap: 0;
        }

        .message-container[data-source-type="user"] .message-actions-container {
            right: 46px;
            left: auto;
        }


        .message-actions-container.active {
            display: flex;
        }


        .tool-setting-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }

        .tool-setting-item label {
            margin-left: 8px;
            cursor: pointer;
            flex-grow: 1;
        }


        #drawing-master-enabled-settings,
        #game-host-enabled-settings,
        #writing-master-enabled-settings,
        #character-update-master-enabled-settings,
        #private-assistant-enabled-settings,

        #novel-bookshelf-page .novel-activation-checkbox {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            width: 16px;
            height: 16px;
            border: 2px solid #777;
            border-radius: 3px;
            background-color: #252525;
            cursor: pointer;
            position: relative;
            flex-shrink: 0;
            vertical-align: middle;
            margin-left: 5px;
        }

        #drawing-master-enabled-settings:checked,
        #game-host-enabled-settings:checked,
        #writing-master-enabled-settings:checked,
        #character-update-master-enabled-settings:checked,
        #private-assistant-enabled-settings:checked,

        #novel-bookshelf-page .novel-activation-checkbox:checked {
            border-color: #e0c2a3;
        }

        #drawing-master-enabled-settings:checked::after,
        #game-host-enabled-settings:checked::after,
        #writing-master-enabled-settings:checked::after,
        #character-update-master-enabled-settings:checked::after,
        #private-assistant-enabled-settings:checked::after,

        #novel-bookshelf-page .novel-activation-checkbox:checked::after {
            content: 'âœ”';
            display: block;
            position: absolute;
            top: -1px;
            left: 0px;
            width: 100%;
            height: 100%;
            font-size: 14px;
            line-height: 16px;
            text-align: center;
            color: #e0c2a3;
        }


        #novel-interface {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #FFF2E2;
            color: #000;
            z-index: 8;
            overflow: hidden;

            flex-direction: column;
        }
        #novel-interface.active {
            display: flex;
        }

        #novel-interface-toolbar {
            position: absolute;
            top: 0;
            right: 0;
            height: 36px;
            display: flex;
            align-items: center;
            padding-right: 108px;
            z-index: 9;
        }

        #novel-bookshelf-button,
        #novel-toc-button {
             background-color: transparent;
             color: #3a3a3a;
             border-color: #3a3a3a;
             margin-left: 0px;
        }


        #novel-bookshelf-button {
            position: absolute;
            top: 0;
            right: 111px;
        }
        #novel-toc-button {
            position: absolute;
            top: 0;
            right: 147px;
        }

        #novel-content-area {
            flex-grow: 1;
            height: calc(100% - 36px);
            overflow-y: auto;
            padding: 46px 10px 10px 10px;
            box-sizing: border-box;
            font-size: 1em;
            line-height: 1.3;
            white-space: pre-wrap;
            overflow-wrap: break-word;
            margin-top: 36px;
        }

        #novel-content-area .novel-chapter-marker {
            display: block;
            font-weight: bold;
            margin-top: 0.5em;
            margin-bottom: 0.2em;
        }



        #novel-bookshelf-page,
        #novel-toc-page {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: inherit;
            color: inherit;
            z-index: 10;
            overflow-y: auto;
            flex-direction: column;
        }
        #novel-bookshelf-page.active,
        #novel-toc-page.active {
            display: flex;
        }


        .novel-page-header {
             text-align: center;
             color: #3a3a3a;
             margin-bottom: 8px;
             padding-bottom: 5px;
             border-bottom: 1px solid #ccc;
             position: relative;
             height: 36px;
             display: flex;
             align-items: center;
             justify-content: center;
             flex-shrink: 0;
        }


        .novel-close-button {
             position: absolute;
             top: 0;
             right: 0;
             background-color: transparent;
             color: #3a3a3a;
             border-color: #3a3a3a;
        }

        .novel-page-section {
            box-sizing: border-box;
            padding-top: 10px;
            flex-grow: 1;
            overflow-y: auto;
        }

        .novel-page-group {
            margin-bottom: 20px;
            padding: 0 10px;
        }


        #novel-bookshelf-list-container .novel-bookshelf-item,
        #novel-toc-list-container .novel-toc-item {
            padding: 8px;
            background-color: #f0e6d8;
            color: #000;
            margin-bottom: 5px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }
        #novel-bookshelf-list-container .novel-bookshelf-item label {
            flex-grow: 1;
            margin-left: 5px;
            margin-right: 5px;
        }
        #novel-bookshelf-list-container .novel-bookshelf-item input[type="radio"] {
             appearance: none;
             -webkit-appearance: none;
             -moz-appearance: none;
             width: 16px;
             height: 16px;
             border: 2px solid #777;
             border-radius: 50%;
             background-color: #FFF2E2;
             cursor: pointer;
             position: relative;
             flex-shrink: 0;
        }
         #novel-bookshelf-list-container .novel-bookshelf-item input[type="radio"]:checked {
             border-color: #8B4513;
         }
         #novel-bookshelf-list-container .novel-bookshelf-item input[type="radio"]:checked::after {
            content: '';
            display: block;
            position: absolute;
            top: 3px;
            left: 3px;
            width: 8px;
            height: 8px;
            background-color: #8B4513;
            border-radius: 50%;
         }

         #novel-toc-list-container .novel-toc-item {
             cursor: pointer;
             text-align: left;
             white-space: nowrap;
             overflow: hidden;
             text-overflow: ellipsis;
         }

         .ai-response .game-host-controls {
             display: flex;
             margin-bottom: 5px;
             gap: 5px;
         }

         .ai-response .game-host-view-button {
             display: inline-block;
             background: none;
             border: none;
             padding: 0;
             margin: 0;
             font-size: 1.2em;
             cursor: pointer;
             color: #3a3a3a;
             vertical-align: middle;
             width: auto;
             height: auto;
             line-height: normal;
             border-radius: 0;
         }

         .ai-response .game-host-view-button.active {
             opacity: 0.5;
             background: none;
             color: #3a3a3a;
             border: none;
         }

         .ai-response .game-host-content {
             font-size: 0.9em;
             line-height: 1.6;
             margin-top: 5px;
             padding: 0;
             color: #3a3a3a;
             white-space: normal;
         }
         .ai-response .game-host-content .value-block {
             display: inline-block;
             background-color: #e8d8c2;
             color: #3a3a3a;
             padding: 1px 5px;
             border-radius: 3px;
             margin-right: 5px;
             margin-bottom: 3px;
             white-space: pre-wrap;
             vertical-align: baseline;
         }
         .ai-response .game-host-content .icon {
             margin-right: 5px;
             vertical-align: baseline;
         }
         .ai-response .game-host-content > div {
             margin-bottom: 2px;
         }

         #api-key-failure-counts-display {
            font-size: 0.8em;
            color: #aaa;
            max-height: 100px;
            overflow-y: auto;
            background-color: #1c1c1c;
            padding: 5px;
            border-radius: 3px;
            border: 1px solid #444;
        }
        #api-key-failure-counts-display div {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 3px;
        }
        #api-key-failure-counts-display .key-prefix {
            color: #bbb;
            margin-right: 5px;
        }
        #api-key-failure-counts-display .fail-count {
            font-weight: bold;
            color: #d99;
            margin-left: 5px;
        }
         #prompt-preset-list-container {
            margin-top: 10px;
         }
         .prompt-preset-actions {
             display: flex;
             gap: 10px;
             margin-bottom: 10px;
         }
         .prompt-preset-actions .settings-menu-item {
             margin-bottom: 0;
             width: auto;
             flex-grow: 1;
             text-align: center;
         }

         .chatroom-management-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
         }
         .chatroom-management-grid .settings-menu-item {
             margin-bottom: 0;
         }

        #pending-action-button-container {
            margin: 0;
            position: absolute;
            top: 36px;
            right: 0px;
            z-index: 5;
            display: flex;
            justify-content: flex-end;
        }

        #pending-action-button-container .std-button {
            background-color: transparent;
        }

    </style>
</head>
<body>

    <div id="chat-container">
        <div id="settings-icon" class="std-button">âš™</div>
        <div id="novel-button" class="std-button">ğŸ“–</div>

        <div id="top-toolbar">
            <div id="role-button" class="std-button">ğŸ‘¤</div>
            <div id="rule-button" class="std-button">ğŸ“œ</div>
            <div id="loading-spinner"></div>
             <div style="margin-left: auto; display: flex; flex-direction: column; align-items: flex-end;">
                <div style="display: flex; align-items: center;">
                    <div id="add-admin-button" class="std-button">ğŸ“</div>
                    <div id="run-pause-button" class="std-button">â–¶</div>
                </div>
                <div id="pending-action-button-container" style="margin: 0;"></div>
             </div>
        </div>

        <div id="role-buttons-wrapper">
           <div id="role-buttons-list-container">
           </div>
        </div>

        <div id="active-role-trigger-list">
        </div>


        <div id="settings-panel">

             <div id="settings-main-page" class="setting-page-template active" style="flex-direction: column;">
                 <div class="settings-header">
                     è®¾ç½®

                 </div>
                 <div id="settings-menu" class="settings-section">
                     <div class="settings-menu-item" data-target="api-settings-page">API è®¾ç½®</div>
                     <div class="settings-menu-item" data-target="prompt-preset-page">æç¤ºè¯é¢„è®¾</div>
                     <div class="settings-menu-item" data-target="novelai-settings-page">ç»˜å›¾è®¾ç½®</div>
                     <div class="settings-menu-item" data-target="error-log-page">æŠ¥é”™æ—¥å¿—</div>

                     <div class="settings-menu-item" data-target="chat-room-settings-page">èŠå¤©å®¤è®¾ç½®</div>
                     <div class="settings-menu-item" data-target="tool-list-page">å·¥å…·åˆ—è¡¨</div>

                 </div>
             </div>

             <div id="api-settings-page" class="setting-page-template" style="flex-direction: column;">
                 <div class="settings-header">
                     API è®¾ç½®
                     <div class="close-button std-button">âœ•</div>
                 </div>
                  <div class="settings-section">
                    <div class="settings-group api-settings">
                        <label for="api-key-textarea-settings" class="settings-label">è°·æ­Œ API å¯†é’¥ (æ¯è¡Œä¸€ä¸ª)</label>
                        <textarea id="api-key-textarea-settings" class="settings-textarea"></textarea>
                        <div id="api-key-failure-counts-display" class="settings-group" style="margin-top: 10px;"></div>
                    </div>

                    <div class="settings-group sending-settings">
                        <label for="temperature-settings" class="settings-label">Temperature</label>
                        <input type="number" id="temperature-settings" class="settings-input" value="1.0" step="0.1">

                        <label for="top-p-settings" class="settings-label">Top P</label>
                        <input type="number" id="top-p-settings" class="settings-input" value="0.9" step="0.01">

                        <label for="top-k-settings" class="settings-label">Top K</label>
                        <input type="number" id="top-k-settings" class="settings-input" value="40" type="number">

                        <label for="max-output-tokens-settings" class="settings-label">Max Output Tokens</label>
                        <input type="number" id="max-output-tokens-settings" class="settings-input" value="2048">

                        <label for="response-mime-type-settings" class="settings-label">Response Mime Type</label>
                        <select id="response-mime-type-settings" class="settings-select">
                            <option value="text/plain">text/plain</option>
                            <option value="application/json" selected>application/json</option>
                            <option value="text/x.enum">text/x-enum</option>
                        </select>
                    </div>
                  </div>
             </div>

             <div id="prompt-preset-page" class="setting-page-template" style="flex-direction: column;">
                 <div class="settings-header">
                     æç¤ºè¯é¢„è®¾
                     <div class="close-button std-button">âœ•</div>
                 </div>
                 <div class="settings-section">
                     <div class="settings-group">
                         <label for="system-instruction-preset-settings" class="settings-label">System Instruction (å…¨å±€)</label>
                         <textarea id="system-instruction-preset-settings" class="settings-textarea"></textarea>
                     </div>
                     <div class="settings-group">
                         <label class="settings-label">å¯¹è¯è½®æ¬¡é¢„è®¾</label>
                         <div class="prompt-preset-actions">
                             <div id="add-prompt-user-turn-button" class="settings-menu-item">æ·»åŠ  U</div>
                             <div id="add-prompt-model-turn-button" class="settings-menu-item">æ·»åŠ  M</div>
                         </div>
                         <div id="prompt-preset-list-container">
                         </div>
                          <div class="prompt-preset-actions" style="margin-top: 15px;">
                             <div id="export-prompt-presets-button" class="settings-menu-item">å¯¼å‡ºé¢„è®¾</div>
                             <input type="file" id="import-prompt-presets-file" style="display: none;" accept=".json">
                             <div id="import-prompt-presets-button" class="settings-menu-item">å¯¼å…¥é¢„è®¾</div>
                         </div>
                     </div>
                 </div>
             </div>


             <div id="novelai-settings-page" class="setting-page-template" style="flex-direction: column;">
                <div class="settings-header">
                    ç»˜å›¾è®¾ç½®
                    <div class="close-button std-button">âœ•</div>
                </div>
                <div class="settings-section">
                   <div class="settings-group novelai-api">
                       <label for="novelai-api-key-settings" class="settings-label">NovelAI API Key</label>
                       <input type="text" id="novelai-api-key-settings" class="settings-input">

                       <label for="novelai-model-settings" class="settings-label">æ¨¡å‹ (Model)</label>
                       <select id="novelai-model-settings" class="settings-select">
                           <option value="nai-diffusion-3">nai-diffusion-3</option>
                           <option value="nai-diffusion-4-curated-preview">nai-diffusion-4-curated-preview</option>
                           <option value="nai-diffusion-4-full">nai-diffusion-4-full</option>
                       </select>
                   </div>
                   <div class="settings-group novelai-prompts">
                       <label for="novelai-artist-chain-settings" class="settings-label">è‰ºæœ¯å®¶é“¾ (Artist Chain)</label>
                       <input type="text" id="novelai-artist-chain-settings" class="settings-input" autocomplete="off">

                       <label for="novelai-default-positive-prompt-settings" class="settings-label">é»˜è®¤æ­£é¢æç¤ºè¯</label>
                       <textarea id="novelai-default-positive-prompt-settings" class="settings-textarea"></textarea>

                       <label for="novelai-default-negative-prompt-settings" class="settings-label">é»˜è®¤è´Ÿé¢æç¤ºè¯</label>
                       <textarea id="novelai-default-negative-prompt-settings" class="settings-textarea"></textarea>

                       <label for="novelai-last-prompt-display" class="settings-label">ä¸Šæ¬¡å‘é€çš„ä¸»è¦ç»˜å›¾æç¤ºè¯</label>
                       <textarea id="novelai-last-prompt-display" class="settings-textarea" readonly></textarea>
                   </div>
                   <div class="settings-group novelai-params">
                       <label for="novelai-width-settings" class="settings-label">å®½åº¦ (Width)</label>
                       <input type="number" id="novelai-width-settings" class="settings-input" value="1024" step="64">

                       <label for="novelai-height-settings" class="settings-label">é«˜åº¦ (Height)</label>
                       <input type="number" id="novelai-height-settings" class="settings-input" value="1024" step="64">

                       <label for="novelai-steps-settings" class="settings-label">æ­¥æ•° (Steps)</label>
                       <input type="number" id="novelai-steps-settings" class="settings-input" value="28" min="1" max="50">

                       <label for="novelai-scale-settings" class="settings-label">å¼•å¯¼ç³»æ•° (Scale)</label>
                       <input type="number" id="novelai-scale-settings" class="settings-input" value="5" step="0.1">

                       <label for="novelai-cfg-rescale-settings" class="settings-label">CFG é‡è°ƒ (CFG Rescale)</label>
                       <input type="number" id="novelai-cfg-rescale-settings" class="settings-input" value="0" step="0.01">

                       <label for="novelai-sampler-settings" class="settings-label">é‡‡æ ·å™¨ (Sampler)</label>
                       <select id="novelai-sampler-settings" class="settings-select">
                           <option value="k_euler">k_euler</option>
                           <option value="k_euler_ancestral">k_euler_ancestral</option>
                           <option value="k_dpmpp_2s_ancestral">k_dpmpp_2s_ancestral</option>
                           <option value="k_dpmpp_2m">k_dpmpp_2m</option>
                           <option value="k_dpm_2">k_dpm_2</option>
                           <option value="ddim_v3">ddim_v3</option>
                       </select>

                       <label for="novelai-noise-schedule-settings" class="settings-label">å™ªç‚¹è°ƒåº¦ (Noise Schedule)</label>
                       <select id="novelai-noise-schedule-settings" class="settings-select">
                            <option value="native">native</option>
                            <option value="karras">karras</option>
                            <option value="exponential">exponential</option>
                            <option value="polyexponential">polyexponential</option>
                       </select>

                       <label for="novelai-seed-settings" class="settings-label">ç§å­ (Seed) (0 = éšæœº)</label>
                       <input type="number" id="novelai-seed-settings" class="settings-input" value="0" min="0">
                   </div>
                </div>
             </div>


             <div id="error-log-page" class="setting-page-template" style="flex-direction: column;">
                 <div class="settings-header">
                     æŠ¥é”™æ—¥å¿—
                     <div class="close-button std-button">âœ•</div>
                 </div>
                 <div class="settings-section">
                    <div class="settings-group error-log-settings">
                        <label for="error-log-display" class="settings-label">é”™è¯¯ä¿¡æ¯ (ä»…è¿è¡Œæ—¶)</label>
                        <textarea id="error-log-display" class="settings-textarea" readonly></textarea>
                        <div id="clear-error-log-button" class="settings-menu-item">æ¸…ç©ºé”™è¯¯æ—¥å¿—</div>
                        <div id="copy-error-log-button" class="settings-menu-item">å¤åˆ¶é”™è¯¯ä¿¡æ¯</div>
                        <div id="clear-all-config-button" class="settings-menu-item" style="color: red; border-color: red;">æ¸…ç©ºå…¨éƒ¨é…ç½® (å±é™©)</div>
                        <div id="export-config-button" class="settings-menu-item">å¯¼å‡ºå®Œæ•´é…ç½® (ZIP)</div>
                        <input type="file" id="import-config-file" style="display: none;" accept=".zip">
                        <div id="import-config-button" class="settings-menu-item">å¯¼å…¥å®Œæ•´é…ç½® (ZIP)</div>
                    </div>
                 </div>
             </div>


             <div id="role-list-page" class="setting-page-template" style="flex-direction: column;">
                 <div class="settings-header">
                     èŠå¤©å®¤è§’è‰²
                     <div class="close-button std-button">âœ•</div>
                 </div>
                  <div class="settings-section">
                    <div class="settings-group role-list">

                        <div id="role-list-container">
                        </div>
                    </div>
                 </div>
             </div>

             <div id="role-detail-page" class="setting-page-template" style="flex-direction: column;">
                 <div class="settings-header">
                     <span id="role-detail-header-title">è§’è‰²è¯¦æƒ…</span>
                     <div class="close-button std-button">âœ•</div>
                 </div>
                  <div class="settings-section">
                    <div class="settings-group role-detail">
                        <label for="role-instruction-textarea" class="settings-label">è§’è‰²è®¾å®š</label>
                        <textarea id="role-instruction-textarea" class="settings-textarea"></textarea>

                        <label for="role-memory-textarea" class="settings-label">è§’è‰²è®°å¿†</label>
                        <textarea id="role-memory-textarea" class="settings-textarea"></textarea>

                        <label for="role-state-textarea" class="settings-label">è§’è‰²çŠ¶æ€</label>
                        <textarea id="role-state-textarea" class="settings-textarea" readonly></textarea>

                        <label for="role-drawing-template-settings" class="settings-label">Drawing Template</label>
                        <input type="text" id="role-drawing-template-settings" class="settings-input" autocomplete="off">

                        <div id="export-role-button" class="settings-menu-item" style="margin-top: 15px;">å¯¼å‡ºæ­¤è§’è‰²</div>
                        <input type="file" id="import-role-file" style="display: none;" accept=".json">
                        <div id="import-role-button" class="settings-menu-item">å¯¼å…¥æ­¤è§’è‰²</div>
                    </div>
                 </div>
             </div>


             <div id="tool-list-page" class="setting-page-template" style="flex-direction: column;">
                 <div class="settings-header">
                     å·¥å…·åˆ—è¡¨
                     <div class="close-button std-button">âœ•</div>
                 </div>
                 <div id="tool-list-container" class="settings-section">
                     <div id="tool-list-menu" class="settings-section">
                         <div class="settings-menu-item tool-item" data-target="drawing-master-page">ç»˜å›¾å¤§å¸ˆ</div>
                         <div class="settings-menu-item tool-item" data-target="game-host-page">æ¸¸æˆä¸»æŒäºº</div>
                         <div class="settings-menu-item tool-item" data-target="writing-master-page">å†™ä½œå¤§å¸ˆ</div>
                         <div class="settings-menu-item tool-item" data-target="character-update-master-page">è§’è‰²æ›´æ–°å¤§å¸ˆ</div>
                         <div class="settings-menu-item tool-item" data-target="private-assistant-page">ç§äººåŠ©ç†</div>
                     </div>
                 </div>
             </div>

             <div id="chat-room-settings-page" class="setting-page-template" style="flex-direction: column;">
                 <div class="settings-header">
                     èŠå¤©å®¤è®¾ç½®
                     <div class="close-button std-button">âœ•</div>
                 </div>
                 <div id="chat-room-settings-menu" class="settings-section">
                     <div class="settings-menu-item" data-target="general-config-page">é€šç”¨é…ç½®</div>
                     <div class="settings-menu-item" data-target="chat-room-directory-page">èŠå¤©å®¤ç›®å½•</div>
                 </div>
             </div>

             <div id="general-config-page" class="setting-page-template" style="flex-direction: column;">
                 <div class="settings-header">
                     é€šç”¨é…ç½®
                     <div class="close-button std-button">âœ•</div>
                 </div>
                  <div class="settings-section">
                    <div class="settings-group general-config">
                         <label for="reference-text-length-settings" class="settings-label">å‚è€ƒæ–‡æœ¬å­—ç¬¦æ•°</label>
                         <input type="number" id="reference-text-length-settings" class="settings-input" value="40000" step="1000">

                         <label for="chatroom-model-select-settings" class="settings-label">æ¨¡å‹ (è§’è‰²/ä¸´æ—¶è§’è‰²)</label>
                         <select id="chatroom-model-select-settings" class="settings-select" style="width: 100%;">
                             <option value="" disabled selected>æ­£åœ¨åŠ è½½æ¨¡å‹åˆ—è¡¨...</option>
                         </select>

                         <label for="response-schema-json-settings" class="settings-label">Response Schema (JSON) (è§’è‰²/ä¸´æ—¶è§’è‰²)</label>
                         <textarea id="response-schema-json-settings" class="settings-textarea"></textarea>

                         <label for="response-schema-parser-js-settings" class="settings-label">Response Schema Parser (JS) (è§’è‰²/ä¸´æ—¶è§’è‰²)</label>
                         <textarea id="response-schema-parser-js-settings" class="settings-textarea"></textarea>

                         <label for="shared-database-instruction-settings" class="settings-label">å…±äº«æ•°æ®åº“ (è§’è‰²/ä¸´æ—¶è§’è‰²)</label>
                         <textarea id="shared-database-instruction-settings" class="settings-textarea"></textarea>

                         <label for="chatroom-main-prompt-settings" class="settings-label">ä¸»æç¤ºè¯ (è§’è‰²/ä¸´æ—¶è§’è‰²)</label>
                         <textarea id="chatroom-main-prompt-settings" class="settings-textarea"></textarea>
                    </div>
                 </div>
             </div>

             <div id="chat-room-directory-page" class="setting-page-template" style="flex-direction: column;">
                 <div class="settings-header">
                     èŠå¤©å®¤ç›®å½•
                     <div class="close-button std-button">âœ•</div>
                 </div>
                  <div class="settings-section">
                    <div class="settings-group chat-room-directory">
                        <div id="add-chatroom-button" class = "settings-menu-item">å</div>
                        <div id="chatroom-list-container">
                        </div>
                    </div>
                 </div>
             </div>

             <div id="chat-room-detail-page" class="setting-page-template" style="flex-direction: column;">
                 <div class="settings-header">
                     <span id="chatroom-detail-header-title">èŠå¤©å®¤è¯¦æƒ… - 1</span>
                     <div class="close-button std-button">âœ•</div>
                 </div>
                 <div id="chatroom-settings-menu" class="settings-section">
                     <div class="settings-menu-item" data-target="current-chatroom-settings-page">å½“å‰èŠå¤©å®¤è®¾ç½®</div>
                     <div class="settings-menu-item" data-target="role-list-page">èŠå¤©å®¤è§’è‰²</div>
                     <div class="settings-menu-item" data-target="story-mode-page">èŠå¤©å®¤å°è¯´</div>
                 </div>

             </div>

             <div id="current-chatroom-settings-page" class="setting-page-template" style="flex-direction: column;">
                 <div class="settings-header">
                     å½“å‰èŠå¤©å®¤è®¾ç½®
                     <div class="close-button std-button">âœ•</div>
                 </div>
                 <div class="settings-section">
                    <div class="settings-group current-chatroom-settings">
                        <label for="chatroom-history-display" class="settings-label">æ¶ˆæ¯è®°å½•</label>
                        <textarea id="chatroom-history-display" class="settings-textarea" readonly></textarea>
                        <div id="clear-chatroom-history-button" class="settings-menu-item">æ¸…ç©ºæ¶ˆæ¯è®°å½•</div>

                        <label for="world-info-display" class="settings-label">æœ€æ–°ä¸–ç•Œä¿¡æ¯</label>
                        <textarea id="world-info-display" class="settings-textarea" readonly></textarea>

                        <label for="roleplay-rules-textarea" class="settings-label">æ‰®æ¼”è§„åˆ™ (å½“å‰èŠå¤©å®¤)</label>
                        <textarea id="roleplay-rules-textarea" class="settings-textarea"></textarea>

                        <label for="public-info-textarea" class="settings-label">å…¬å…±ä¿¡æ¯ (å½“å‰èŠå¤©å®¤)</label>
                        <textarea id="public-info-textarea" class="settings-textarea"></textarea>

                         <div class="chatroom-management-grid">
                            <div id="rename-chatroom-button" class="settings-menu-item">é‡å‘½å</div>
                            <div id="delete-chatroom-button" class="settings-menu-item" style="color: red; border-color: red;">åˆ é™¤</div>
                            <div id="export-chatroom-button" class="settings-menu-item">å¯¼å‡º (ZIP)</div>
                            <input type="file" id="import-chatroom-file" style="display: none;" accept=".zip">
                            <div id="import-chatroom-button" class="settings-menu-item">å¯¼å…¥ (ZIP)</div>
                        </div>
                    </div>
                 </div>
             </div>


             <div id="story-mode-page" class="setting-page-template" style="flex-direction: column;">
                 <div class="settings-header">
                     èŠå¤©å®¤å°è¯´
                     <div class="close-button std-button">âœ•</div>
                 </div>
                 <div class="settings-section">
                    <div class="settings-group story-mode-list">

                        <div id="novel-list-container">
                        </div>
                    </div>
                 </div>
             </div>


             <div id="drawing-master-page" class="setting-page-template" style="flex-direction: column;">
                 <div class="settings-header">
                     ç»˜å›¾å¤§å¸ˆ
                     <div class="close-button std-button">âœ•</div>
                 </div>
                 <div class="settings-section">
                    <div class="settings-group god-settings">
                        <div class="tool-setting-item">
                            <label for="drawing-master-enabled-settings">å¯ç”¨</label>
                            <input type="checkbox" id="drawing-master-enabled-settings">
                        </div>

                        <label for="drawing-master-model-settings" class="settings-label">æ¨¡å‹</label>
                        <select id="drawing-master-model-settings" class="settings-select" style="width: 100%;">
                             <option value="" disabled selected>æ­£åœ¨åŠ è½½æ¨¡å‹åˆ—è¡¨...</option>
                        </select>

                        <label for="drawing-master-response-schema-json-settings" class="settings-label">Response Schema (JSON)</label>
                        <textarea id="drawing-master-response-schema-json-settings" class="settings-textarea"></textarea>

                        <label for="drawing-master-response-schema-parser-js-settings" class="settings-label">Response Schema Parser (JS)</label>
                        <textarea id="drawing-master-response-schema-parser-js-settings" class="settings-textarea"></textarea>

                        <label for="drawing-master-tool-database-instruction-settings" class="settings-label">æ•°æ®åº“</label>
                        <textarea id="drawing-master-tool-database-instruction-settings" class="settings-textarea"></textarea>

                        <label for="drawing-master-main-prompt-settings" class="settings-label">ä¸»æç¤ºè¯</label>
                        <textarea id="drawing-master-main-prompt-settings" class="settings-textarea"></textarea>
                    </div>
                 </div>
             </div>

             <div id="game-host-page" class="setting-page-template" style="flex-direction: column;">
                 <div class="settings-header">
                     æ¸¸æˆä¸»æŒäºº
                     <div class="close-button std-button">âœ•</div>
                 </div>
                 <div class="settings-section">
                    <div class="settings-group god-settings">
                        <div class="tool-setting-item">
                            <label for="game-host-enabled-settings">å¯ç”¨</label>
                            <input type="checkbox" id="game-host-enabled-settings">
                        </div>

                        <label for="game-host-model-settings" class="settings-label">æ¨¡å‹</label>
                        <select id="game-host-model-settings" class="settings-select" style="width: 100%;">
                             <option value="" disabled selected>æ­£åœ¨åŠ è½½æ¨¡å‹åˆ—è¡¨...</option>
                        </select>

                        <label for="game-host-response-schema-json-settings" class="settings-label">Response Schema (JSON)</label>
                        <textarea id="game-host-response-schema-json-settings" class="settings-textarea"></textarea>

                        <label for="game-host-response-schema-parser-js-settings" class="settings-label">Response Schema Parser (JS)</label>
                        <textarea id="game-host-response-schema-parser-js-settings" class="settings-textarea"></textarea>

                        <label for="game-host-tool-database-instruction-settings" class="settings-label">æ•°æ®åº“</label>
                        <textarea id="game-host-tool-database-instruction-settings" class="settings-textarea"></textarea>

                        <label for="game-host-main-prompt-settings" class="settings-label">ä¸»æç¤ºè¯</label>
                        <textarea id="game-host-main-prompt-settings" class="settings-textarea"></textarea>
                    </div>
                 </div>
             </div>

             <div id="writing-master-page" class="setting-page-template" style="flex-direction: column;">
                 <div class="settings-header">
                     å†™ä½œå¤§å¸ˆ
                     <div class="close-button std-button">âœ•</div>
                 </div>
                 <div class="settings-section">
                    <div class="settings-group god-settings">
                        <div class="tool-setting-item">
                            <label for="writing-master-enabled-settings">å¯ç”¨</label>
                            <input type="checkbox" id="writing-master-enabled-settings">
                        </div>

                        <label for="writing-master-model-settings" class="settings-label">æ¨¡å‹</label>
                        <select id="writing-master-model-settings" class="settings-select" style="width: 100%;">
                             <option value="" disabled selected>æ­£åœ¨åŠ è½½æ¨¡å‹åˆ—è¡¨...</option>
                        </select>

                        <label for="writing-master-response-schema-json-settings" class="settings-label">Response Schema (JSON)</label>
                        <textarea id="writing-master-response-schema-json-settings" class="settings-textarea"></textarea>

                        <label for="writing-master-response-schema-parser-js-settings" class="settings-label">Response Schema Parser (JS)</label>
                        <textarea id="writing-master-response-schema-parser-js-settings" class="settings-textarea"></textarea>

                        <label for="writing-master-tool-database-instruction-settings" class="settings-label">æ•°æ®åº“</label>
                        <textarea id="writing-master-tool-database-instruction-settings" class="settings-textarea"></textarea>

                        <label for="writing-master-main-prompt-settings" class="settings-label">ä¸»æç¤ºè¯</label>
                        <textarea id="writing-master-main-prompt-settings" class="settings-textarea"></textarea>
                    </div>
                 </div>
             </div>

             <div id="character-update-master-page" class="setting-page-template" style="flex-direction: column;">
                 <div class="settings-header">
                     è§’è‰²æ›´æ–°å¤§å¸ˆ
                     <div class="close-button std-button">âœ•</div>
                 </div>
                 <div class="settings-section">
                    <div class="settings-group god-settings">
                        <div class="tool-setting-item">
                            <label for="character-update-master-enabled-settings">å¯ç”¨</label>
                            <input type="checkbox" id="character-update-master-enabled-settings">
                        </div>

                         <label for="character-update-master-model-settings" class="settings-label">æ¨¡å‹</label>
                         <select id="character-update-master-model-settings" class="settings-select" style="width: 100%;">
                             <option value="" disabled selected>æ­£åœ¨åŠ è½½æ¨¡å‹åˆ—è¡¨...</option>
                         </select>

                        <label for="character-update-master-response-schema-json-settings" class="settings-label">Response Schema (JSON)</label>
                        <textarea id="character-update-master-response-schema-json-settings" class="settings-textarea"></textarea>

                        <label for="character-update-master-response-schema-parser-js-settings" class="settings-label">Response Schema Parser (JS)</label>
                        <textarea id="character-update-master-response-schema-parser-js-settings" class="settings-textarea"></textarea>

                        <label for="character-update-master-tool-database-instruction-settings" class="settings-label">æ•°æ®åº“</label>
                        <textarea id="character-update-master-tool-database-instruction-settings" class="settings-textarea"></textarea>

                        <label for="character-update-master-main-prompt-settings" class="settings-label">ä¸»æç¤ºè¯</label>
                        <textarea id="character-update-master-main-prompt-settings" class="settings-textarea"></textarea>
                    </div>
                 </div>
             </div>

             <div id="private-assistant-page" class="setting-page-template" style="flex-direction: column;">
                 <div class="settings-header">
                     ç§äººåŠ©ç†
                     <div class="close-button std-button">âœ•</div>
                 </div>
                 <div class="settings-section">
                    <div class="settings-group god-settings">
                        <div class="tool-setting-item">
                            <label for="private-assistant-enabled-settings">å¯ç”¨</label>
                            <input type="checkbox" id="private-assistant-enabled-settings">
                        </div>

                         <label for="private-assistant-model-settings" class="settings-label">æ¨¡å‹</label>
                         <select id="private-assistant-model-settings" class="settings-select" style="width: 100%;">
                             <option value="" disabled selected>æ­£åœ¨åŠ è½½æ¨¡å‹åˆ—è¡¨...</option>
                         </select>

                        <label for="private-assistant-response-schema-json-settings" class="settings-label">Response Schema (JSON)</label>
                        <textarea id="private-assistant-response-schema-json-settings" class="settings-textarea"></textarea>

                        <label for="private-assistant-response-schema-parser-js-settings" class="settings-label">Response Schema Parser (JS)</label>
                        <textarea id="private-assistant-response-schema-parser-js-settings" class="settings-textarea"></textarea>

                        <label for="private-assistant-tool-database-instruction-settings" class="settings-label">æ•°æ®åº“</label>
                        <textarea id="private-assistant-tool-database-instruction-settings" class="settings-textarea"></textarea>

                        <label for="private-assistant-main-prompt-settings" class="settings-label">ä¸»æç¤ºè¯</label>
                        <textarea id="private-assistant-main-prompt-settings" class="settings-textarea"></textarea>
                    </div>
                 </div>
             </div>

        </div>


        <div id="novel-interface">
            <div id="novel-interface-toolbar">
                 <div id="novel-toc-button" class="std-button">â˜°</div>
                 <div id="novel-bookshelf-button" class="std-button">ğŸ“š</div>
            </div>


            <div id="novel-content-area">

            </div>


            <div id="novel-bookshelf-page">
                 <div class="novel-page-header">
                     ä¹¦ç›®
                     <div class="novel-close-button std-button">âœ•</div>
                 </div>
                 <div class="novel-page-section">
                    <div class="novel-page-group">
                        <div id="novel-bookshelf-list-container">

                        </div>
                    </div>
                 </div>
            </div>


            <div id="novel-toc-page">
                 <div class="novel-page-header">
                     ç›®å½•
                     <div class="novel-close-button std-button">âœ•</div>
                 </div>
                 <div class="novel-page-section">
                    <div class="novel-page-group">
                        <div id="novel-toc-list-container">

                        </div>
                    </div>
                 </div>
            </div>
        </div>



        <div id="chat-area">

        </div>

        <div id="image-viewer-page">
             <img id="image-viewer-content" src="" alt="Image Viewer">
        </div>
    </div>


    <script src="core.js"></script>
    <script src="ui_elements.js"></script>
    <script src="ui_settings.js"></script>
    <script src="ui_chat.js"></script>
    <script src="main.js"></script>
</body>
</html>