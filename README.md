# 绳墨 - 您的私人 AI 交互与创作空间

**绳墨** 是一款专为个人打造的、功能丰富、界面简约的 AI 交互与创作工具。它以浏览器为载体，结合强大的后端服务，为您提供一个高度可定制化、私密且高效的 AI 体验环境。无论您是想进行沉浸式角色扮演、利用 AI 进行绘图创作，还是管理复杂的对话场景、阅读并引用参考资料，绳墨都能满足您的需求。

---

## ✨ 核心特性

*   **🚀 双 AI 引擎驱动:** 同时集成强大的 **谷歌 Gemini** 模型和 **NovelAI** 图像生成能力。
*   **🎭 深度角色扮演:** 支持多角色定义、状态管理、记忆与设定分离，构建生动的虚拟世界。
*   **🎨 AI 绘图集成:** 无缝调用 NovelAI 进行图像生成，支持丰富的参数调整和角色绘图模板。
*   **📚 小说阅读与引用:** 内建小说阅读器，可将小说内容作为动态参考信息注入 AI 对话。
*   **🛠️ 智能工具箱:** 配备多种专用 AI 工具（如游戏主持、写作大师等），拓展应用场景。
*   **💬 多聊天室管理:** 支持创建、管理、导入/导出多个独立的聊天场景，保持对话隔离。
*   **⚙️ 高度可配置:** 从 AI 参数到界面行为，提供全面的自定义选项。
*   **📱 移动端优化:** 主要界面为移动端交互设计，布局紧凑，操作便捷。
*   **🔒 本地化部署:** 所有数据（配置、聊天记录、角色、小说）均存储在本地，确保隐私安全。
*   **📦 便捷备份恢复:** 支持一键导出/导入完整配置和聊天室数据。

---

## 📝 详细功能介绍

### 🤖 AI 交互核心

*   **Gemini 模型代理:**
    *   支持接入多种谷歌 Gemini 模型进行文本生成。
    *   可精细调整生成参数：温度（Temperature）、顶P（Top P）、顶K（Top K）、最大输出令牌数。
    *   支持配置响应格式（MIME 类型），适配不同需求。
    *   支持 JSON Schema，实现结构化数据输出。
    *   可自定义 Schema 解析脚本（JavaScript），对 AI 输出进行预处理。
    *   支持全局系统指令（System Instruction）和多轮对话提示词预设（Prompt Preset Turns）。
    *   提供多个 API 密钥轮询机制，并记录失败次数，提高可用性。
    *   完全关闭 Gemini 的安全设置，提供更自由的交互体验。
*   **NovelAI 绘图代理:**
    *   集成 NovelAI 图像生成接口。
    *   可配置使用的 NovelAI 模型（如 NAI Diffusion 3/4 等）。
    *   支持设置默认的正面和负面提示词。
    *   支持艺术家风格链（Artist Chain）。
    *   可为每个角色设定独立的绘图模板（Drawing Template），自动应用于绘图提示词。
    *   全面控制生成参数：图像宽度、高度、步数（Steps）、引导系数（Scale）、CFG 重调（CFG Rescale）、采样器（Sampler）、噪点调度（Noise Schedule）、种子（Seed，0 为随机）。
    *   自动处理 API 请求与响应，将生成的图片直接显示在聊天界面。

### 💬 聊天室系统

*   **多聊天室:**
    *   创建和管理多个独立的聊天室，每个聊天室拥有自己的配置、历史记录、角色和小说。
    *   支持聊天室的重命名、删除。
    *   允许用户自定义聊天室的排序。
    *   可方便地切换当前活动的聊天室。
*   **独立配置:**
    *   每个聊天室可设置独特的“扮演规则”（Roleplay Rules）和“公共信息”（Public Info），这些信息可作为上下文注入 AI 请求。
    *   支持为聊天室设置独立的背景图片。
*   **持久化存储:**
    *   聊天记录自动保存在本地对应的聊天室文件夹内（`history.json`）。
    *   聊天室特定配置（如激活的小说、角色状态等）保存在 `chatroom_config.json` 中。
*   **导入与导出:**
    *   支持将单个聊天室的所有数据（配置、历史、角色、小说、背景图）导出为 ZIP 压缩包。
    *   支持从 ZIP 压缩包导入聊天室数据，轻松迁移或分享场景。

### 🎭 角色扮演（RP）系统

*   **角色定义:**
    *   在每个聊天室中，可以创建和管理多个“永久角色”。
    *   每个角色包含独立的“设定”（Setting）、“记忆”（Memory）和“绘图模板”（Drawing Template）。
    *   支持角色的编辑、删除，以及单个角色的导入/导出（JSON 格式）。
*   **临时角色:**
    *   支持在聊天过程中动态创建“临时角色”，无需预先定义文件。
*   **角色状态管理:**
    *   提供直观的角色状态切换按钮，管理每个角色的行为模式：
        *   `默` (默认/静默): 角色不主动参与，仅作为背景信息。
        *   `活` (活动): 角色由 AI 控制，根据设定和场景自动发言或行动。
        *   `用` (用户控制): 角色行为由用户手动输入，AI 不会代为行动。
        *   `更` (更新): 触发“角色更新大师”工具，分析近期对话以更新该角色的记忆或设定。
*   **角色状态存储:**
    *   基础状态（默/活/用/更）存储在聊天室配置中。
    *   “角色详细状态”（Role Detailed States）用于存储更复杂的、可能由工具（如游戏主持、角色更新大师）生成和更新的角色信息。

### 🛠️ 智能工具箱

绳墨内置了一系列专用 AI 工具，可在后台运行，辅助主对话流程：

*   **通用配置:** 每个工具均可独立启用/禁用，并可配置其使用的 Gemini 模型、主提示词、数据库指令、响应 Schema 及解析脚本。
*   **绘图大师 (Drawing Master):**
    *   负责解析绘图需求，结合角色绘图模板和场景信息，生成发送给 NovelAI 的具体提示词。
*   **游戏主持人 (Game Host):**
    *   可能用于管理基于文本的游戏或模拟场景的状态。
    *   能够输出场景上下文、更新角色状态、处理行动结果，并将这些信息结构化地展示在聊天界面。
*   **写作大师 (Writing Master):**
    *   可能用于根据对话内容或特定指令，辅助生成描述性文本或其他创意内容。
*   **角色更新大师 (Character Update Master):**
    *   分析最近的对话历史，智能地更新指定角色的“记忆”或“设定”文件，让角色能够“学习”和“成长”。
*   **私人助理 (Private Assistant):**
    *   一个通用的后台工具，可以配置用于执行各种自定义的后台任务或信息处理。

### 📚 小说阅读与参考

*   **小说管理:**
    *   支持在每个聊天室中添加和管理多部小说。
    *   提供文本文件上传功能，后端会自动将长文本分割成合适的段落（Segments）。
    *   自动提取文本中的章节标记（如“第一章”），并能基于段落数量自动生成补充目录（TOC）。
*   **小说阅读器:**
    *   内建一个独立的小说阅读界面。
    *   提供“书架”视图，展示当前聊天室的所有小说。
    *   提供“目录”视图，方便在章节间快速跳转。
    *   自动记忆每部小说上次阅读到的滚动位置。
*   **激活与引用:**
    *   用户可以在书架中选择要“激活”的小说。
    *   被激活的小说内容（根据当前阅读位置和全局配置的“参考文本字符数”）会自动提取，并作为一个特殊的上下文信息（`{{参考文本}}`）提供给 AI，使其能够“阅读”并引用相关内容。

### ⚙️ 配置与管理

*   **全局配置:**
    *   所有全局设置（如默认 AI 参数、API Key 相关设置、聊天室排序、工具配置等）保存在 `config.json` 文件中。
    *   设置更改后会自动保存。
*   **提示词预设:**
    *   支持配置一套包含系统指令和多轮用户/模型对话的模板。
    *   这些预设会作为基础上下文添加到发送给 Gemini 的请求中。
    *   支持将预设配置导出为 JSON 文件，或从文件中导入。
*   **运行时错误日志:**
    *   前端界面会捕获并显示 JavaScript 运行时错误，方便调试。
*   **完整备份与恢复:**
    *   提供一键导出整个应用状态（全局配置 + 所有聊天室数据）为 ZIP 文件的功能。
    *   支持从 ZIP 文件恢复整个应用状态，非常适合迁移或备份。
*   **数据清理:**
    *   提供“清空全部配置”的危险操作选项，用于彻底重置应用。

### ✨ 用户界面与体验

*   **界面设计:**
    *   主聊天界面 (`gemini_chat.html`) 优先考虑移动设备，布局紧凑，元素间距小。
    *   采用暗色主题，适合长时间使用。
    *   提供一个独立的编辑器界面 (`editor.html`)，可能用于项目文件的直接编辑（需谨慎使用）。
*   **设置面板:**
    *   通过侧滑或点击图标打开设置面板。
    *   设置项按层级和功能模块清晰分类。
*   **聊天界面:**
    *   消息气泡样式区分用户和 AI。
    *   支持显示由 NovelAI 生成的图片。
    *   特殊工具（如游戏主持）的输出有定制化的展示格式。
    *   提供消息操作菜单（长按消息旁的头像/图标触发），支持：
        *   切换显示 AI 消息的原始 JSON 数据或格式化文本。
        *   重新触发绘图（针对绘图大师消息）。
        *   保存角色更新（针对角色更新大师消息）。
        *   删除单条消息 或 删除此条及以下所有消息。
    *   支持直接编辑已发送的消息内容。
*   **交互元素:**
    *   顶栏提供设置入口、小说阅读器入口、运行/暂停按钮、角色列表开关等。
    *   角色列表面板可方便地查看和切换角色状态。
    *   提供加载状态指示器（Spinner）和请求重试时的视觉提示。
    *   为常用操作（如创建管理员消息、添加临时角色）提供快捷按钮。

---

**绳墨** 致力于为您提供一个强大而灵活的本地 AI 交互平台，让您的创意和想法得以自由驰骋。
