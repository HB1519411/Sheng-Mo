**项目名称：绳墨 (Sheng Mo)**

**核心定位：**

“绳墨” 是一个高度可定制化、运行于浏览器的个人聊天交互界面。它主要设计用于与 Google 的 Gemini 系列 AI 模型进行深度交互，并集成了 NovelAI 的图像生成能力，旨在为用户提供一个集对话、角色扮演、故事辅助、内容生成于一体的强大私人 AI 工作台。项目注重轻量化和移动端（尤其是 Termux 环境）的可用性。

**主要功能详解：**

1.  **强大的 AI 对话核心 (Gemini):**
    *   **多模型支持：** 允许配置和选择不同的 Google Gemini 模型，并能为不同任务（如角色扮演 vs 工具运行）指定主要和次要模型。
    *   **精细化参数控制：** 用户可以精确调整 AI 生成的参数，如温度 (Temperature)、Top-P、Top-K 和最大输出词元数 (Max Output Tokens)，以控制 AI 回复的创造性和确定性。
    *   **深度指令定制：** 提供多层级的指令输入框（System, User 1-3, Model 1-2），允许用户构建复杂的多轮对话提示结构，精细引导 AI 的行为模式。
    *   **结构化输出：** 支持定义 JSON Schema 和相应的 JavaScript 解析器，强制 AI 以特定的结构化格式（如 JSON）返回信息，便于后续处理和自动化。
    *   **安全设置绕过：** 配置为忽略 Google AI 的默认内容安全阻止阈值 (`BLOCK_NONE`)，以获取更广泛、可能更自由的 AI 回应（用户需自行承担风险）。
    *   **API 密钥管理：** 支持配置多个 Gemini API 密钥，并自动轮换使用。

2.  **复杂角色扮演与多智能体模拟：**
    *   **“角色”系统：** 允许用户创建和管理复杂的 AI 角色。每个角色拥有独立的“设定”（Instructions/Personality）、“记忆”（Memory）和“绘图模板”（Drawing Template），AI 会在扮演该角色时参考这些信息。
    *   **“简单角色”系统：** 支持快速定义一些功能性或背景性的角色（如默认的“管理员”），它们主要通过名称区分，共享通用的响应配置。
    *   **“工具”系统 (专用智能体)：** 内置多个专用 AI 工具，每个工具拥有独立的启用/禁用开关、显示选项、指令、响应 Schema 和解析器：
        *   **绘图大师 (Drawing Master):** 接收场景描述和角色信息，自动生成符合 NovelAI 格式的提示词，并调用 NovelAI 进行图像生成。
        *   **游戏主持人 (Game Host):** 设计用于驱动叙事或游戏进程。能理解和更新场景上下文、角色状态，并进行游戏逻辑分析（如决定下一行动者），其输出在界面上有专门的可切换视图（时间、地点、角色详情）。
        *   **写作大师 (Writing Master):** 专注于生成描述性文本或根据指令进行内容创作。
        *   **角色更新大师 (Character Update Master):** 观察对话流，根据发生的事件自动更新角色的“设定”和“记忆”，实现角色的动态演进。其输出也是结构化的，并提供一键保存更新的功能。
    *   **动态情境感知 (Placeholder System):** AI 的输入指令中可以使用多种占位符（如 `{{角色名称}}`, `{{消息记录}}`, `{{角色状态集}}`, `{{参考文本}}`, `{{扮演规则}}` 等）。系统会在发送请求前，根据当前的聊天室、激活的角色、角色状态、聊天记录、关联的小说内容等上下文信息，动态地替换这些占位符，使得 AI 的输入高度情境化。
    *   **角色状态控制：** 每个角色（非工具）可以被设置为不同状态（默认/闲置、活跃/AI 控制、用户控制、更新中），这影响了 AI 是否会自动为其生成响应，或是否需要用户手动输入。

3.  **多聊天室与上下文管理：**
    *   **隔离的对话空间：** 支持创建多个聊天室，每个聊天室拥有独立的聊天记录、角色关联、小说关联、扮演规则和公共信息。这使得用户可以同时进行多个不同主题或设定的对话/故事。
    *   **持久化聊天记录：** 每个聊天室的完整对话历史都会被保存，并可以在设置中查看（或清空）。
    *   **房间特定配置：** 可以为每个聊天室单独指定参与的角色、关联的小说，并编写该房间专属的“扮演规则”和“公共信息”，这些信息可以通过占位符提供给 AI。

4.  **小说/文本整合与辅助 (“剧情模式”):**
    *   **文本导入与处理：** 支持从剪贴板导入长文本（如小说），系统会自动进行规范化处理（如合并空行）、分块 (Chunking)，并尝试生成目录 (Table of Contents)，识别原生章节标记（如“第X章”）并根据字数阈值自动添加章节标记。
    *   **专用阅读界面：** 提供一个独立的小说阅读界面，包含书架（管理已导入的小说）和目录视图，支持在小说内部跳转。阅读进度（滚动位置）会被记忆。
    *   **上下文参考 (`{{参考文本}}`)：** 这是“绳墨”的一个特色功能。用户可以将小说与聊天室关联，并“激活”一本或多本小说。当 AI 的指令中包含 `{{参考文本}}` 占位符时，系统会根据用户在小说阅读界面中的当前浏览位置，自动提取该位置前后一定长度（可配置）的小说片段，将其注入到 AI 的提示中。这使得 AI 能够参考长文本内容进行回应，极大地扩展了上下文窗口。

5.  **集成图像生成 (NovelAI):**
    *   **无缝对接：** 通过“绘图大师”工具，将对话中的场景描述转化为 NovelAI 的图像生成请求。
    *   **精细化控制：** 用户可以在设置中配置 NovelAI 的 API 密钥、模型、默认正负向提示词、艺术家风格链，以及各种生成参数（图像尺寸、步数、引导系数、采样器等）。
    *   **角色感知绘图：** 角色的“绘图模板”可以被“绘图大师”使用，生成更符合角色设定的图像。
    *   **界面内展示与交互：** 生成的图片会直接显示在聊天界面中，并提供点击放大查看、设为聊天背景、长按下载等功能。
    *   **请求队列：** 内置 NovelAI 请求队列，避免短时间内发送过多请求。

6.  **全面的配置与数据管理：**
    *   **状态持久化：** 几乎所有的应用状态，包括 API 密钥、模型选择、指令、角色定义、聊天室配置、聊天记录、小说元数据和内容、工具设置等，都会自动或手动保存到后端的 `config.json` 和 `novels/` 目录中。
    *   **导入/导出：** 支持导出整个应用的配置，也可以单独导出/导入角色定义或聊天室数据（包括历史记录和关联信息），方便备份和分享。
    *   **错误日志：** 内置错误日志记录和显示功能，方便排查问题。

7.  **用户界面与体验：**
    *   **移动端优化：** 界面设计考虑了移动设备，布局紧凑。
    *   **暗色主题：** 提供视觉舒适的暗色界面。
    *   **便捷交互：** 提供角色状态快速切换按钮、消息编辑/删除功能（包括长按删除后续所有消息）、原始 JSON 查看、一键保存角色更新等快捷操作。
    *   **可视化状态：** 清晰展示当前激活的聊天室、角色的状态、游戏主持人的多维信息等。

**总结：**

“绳墨” 是一个面向高级用户和 AI 爱好者的强大工具，它不仅仅是一个简单的聊天客户端，更是一个围绕 Google Gemini 和 NovelAI 构建的、高度灵活和可扩展的个人 AI 交互与创作平台。其核心优势在于深度的可定制性、强大的上下文管理能力（尤其是通过小说文本参考）、以及将对话、角色扮演、故事驱动和图像生成融为一体的设计思路。


**欢迎使用 绳墨！**

“绳墨” 是一个功能强大的个人 AI 交互界面，它允许您与 AI 模型（主要是 Google Gemini）进行深度定制的对话，并能结合 NovelAI 进行绘图。本指南将带您从零开始，逐步了解如何使用它的各项功能。

**一、 准备与启动**

1.  **环境要求：**
    *   确保您的计算机或 Termux 环境安装了 **Python 3**。
    *   需要安装 **Flask** 和 **Flask-CORS** 库。在命令行（或 Termux）中运行：
        ```bash
        pip install Flask Flask-CORS requests
        ```
2.  **启动后端服务：**
    *   在命令行中，切换到包含 `backend.py` 文件的项目目录。
    *   运行后端脚本：
        ```bash
        python backend.py
        ```
    *   您会看到类似 `* Running on http://0.0.0.0:5000/` 的输出，表示后端服务已启动。
3.  **访问前端界面：**
    *   打开您的网页浏览器（推荐 Chrome 或 Firefox）。
    *   在地址栏输入 `http://localhost:5000` 或 `http://127.0.0.1:5000` (如果在本机运行)。
    *   如果您在 Termux 中运行并在同一设备访问，通常也是这个地址。如果在局域网内其他设备访问 Termux 上的服务，需要输入 Termux 设备的 IP 地址，例如 `http://<Termux设备IP>:5000`。
    *   您应该能看到 “绳墨” 的主聊天界面。

**二、 核心界面概览**

首次打开，您会看到以下主要区域：

*   **顶部最左侧 ⚙️ (设置图标):** 点击打开或关闭设置面板。所有配置都在这里完成。
*   **顶部最右侧 📖 (小说图标):** 点击打开或关闭小说阅读界面。
*   **顶部工具栏 (从左到右):**
    *   **👤 (角色按钮):** 点击展开或收起当前聊天室的角色列表和状态控制按钮。
    *   **📜 (规则按钮):** 快速跳转到当前聊天室的“扮演规则”和“公共信息”设置区域。
    *   **📏 (管理员/简单角色按钮):**
        *   **单击:** 添加一个新的“简单角色”。
        *   **长按:** 直接为“管理员”角色创建一条用户消息并进入编辑状态。
    *   **▶/◼ (运行/暂停按钮):** 控制 AI 是否自动响应。 **非常重要！** 默认是暂停状态 (▶)，AI 不会自动运行。点击变为运行状态 (◼)，AI 会根据设定自动响应。再次点击暂停。
*   **聊天区域:** 显示对话消息的地方。

**三、 首次配置 (必需步骤)**

在开始聊天前，您必须进行一些基本配置：

1.  **打开设置:** 点击左上角的 ⚙️ 图标。
2.  **进入 API 设置:** 在设置主菜单中，点击 “API 设置”。
3.  **配置 API 密钥:**
    *   找到 “谷歌 API 密钥” 文本框。
    *   将您的 Google Gemini API 密钥粘贴到这里。如果您有多个密钥，每行粘贴一个。**没有有效的 API 密钥，您将无法与 AI 对话。**
    *   *(可选)* 您可以修改下面的 System Instruction、User 1-3、Model 1-2 指令，它们构成了 AI 对话的基础结构。初学者可以暂时使用默认值。
4.  **选择 AI 模型:**
    *   在 “主要模型” 和 “次要模型” 下拉菜单中选择您想要使用的 Gemini 模型。如果列表是空的或显示“加载失败”，请确保您的 API 密钥有效且网络连接正常。**必须至少选择一个主要模型。**
    *   *主要模型* 通常用于角色扮演、写作、角色更新等核心任务。
    *   *次要模型* 通常用于绘图提示生成、游戏主持等辅助任务。您可以将两者设为同一个模型。
5.  **保存配置:** 更改会自动保存，但确保网络连接正常。
6.  **关闭设置:** 点击设置页面右上角的 “✕” 按钮，或再次点击左上角的 ⚙️ 图标。

**四、 开始基本聊天**

1.  **确保 AI 运行:** 点击顶部工具栏的 ▶ 按钮，使其变为 ◼。
2.  **选择或创建聊天室:**
    *   点击 ⚙️ -> 聊天室设置 -> 聊天室目录。
    *   默认可能没有聊天室，点击 “十” 添加新聊天室，输入名称。
    *   选择一个聊天室（点击其名称旁边的圆圈单选按钮）。
    *   关闭设置。
3.  **添加管理员消息 (作为用户发言):** **长按** 顶部工具栏的 📏 按钮。一条属于“管理员”的消息框会出现在聊天区域，并自动进入编辑状态。
4.  **输入内容:** 在编辑框中输入您想对 AI 说的话。
5.  **发送消息:** 输入完成后，在输入框外部点击一下，或者按 Enter 键（如果光标在编辑框内且未按 Shift）。
6.  **等待 AI 回应:** 如果 AI 处于运行状态 (◼)，并且配置正确，AI（通常是默认启用的“游戏主持人”）应该会生成回应。

**五、 深入设置面板**

设置面板是 “绳墨” 的核心，所有高级功能都在这里配置。

1.  **设置主菜单:**
    *   提供到各个子设置页面的入口。

2.  **API 设置 (已在首次配置中涉及):**
    *   **API 密钥:** 管理您的 Google API 密钥。
    *   **指令:** System Instruction 是最高指示；User/Model 1/2/3 用于构建多轮对话模板，占位符会在这里被替换。
    *   **模型选择:** 选择主要和次要 Gemini 模型。
    *   **生成参数:**
        *   `Temperature`: 控制随机性，越高越随机。
        *   `Top P` / `Top K`: 控制采样策略，影响生成文本的多样性。
        *   `Max Output Tokens`: 限制 AI 单次回应的最大长度。
        *   `Response Mime Type`: 通常保持 `application/json`，除非您有特殊需求并了解其影响。

3.  **绘图设置 (NovelAI):**
    *   **API Key:** 粘贴您的 NovelAI API 密钥。**没有这个无法使用绘图功能。**
    *   **模型:** 选择 NovelAI 模型 (e.g., nai-diffusion-3)。
    *   **艺术家链:** 会加在所有提示词前面的风格描述 (e.g., "masterpiece, best quality")。
    *   **默认正面/负面提示词:** 分别附加到生成的主要提示词和负面提示词中。
    *   **上次发送的主要绘图提示词:** 显示最近一次“绘图大师”生成的、发送给 NovelAI 的核心内容提示词（不包括艺术家链和默认词）。
    *   **参数:** 调整宽度、高度、步数 (Steps)、引导系数 (Scale)、CFG Rescale、采样器 (Sampler)、噪点调度 (Noise Schedule)、种子 (Seed, 0=随机)。

4.  **报错日志:**
    *   **错误信息:** 显示运行过程中捕获到的错误，帮助诊断问题。
    *   **清空/导出/导入:** 管理错误日志和整个应用的配置数据。
        *   **导出配置:** 将当前所有设置、角色、聊天室、历史记录等保存到一个 JSON 文件。
        *   **导入配置:** 从之前导出的 JSON 文件加载配置（会覆盖当前设置）。

5.  **角色设置:**
    *   **共用设置:**
        *   `Response Schema (JSON)`: 为“角色”和“简单角色”定义期望 AI 返回的 JSON 结构。
        *   `Response Schema Parser (JS)`: 编写 JavaScript 代码来解析上面定义的 JSON 结构，提取需要的信息（如角色说的话、思考过程等）。
        *   `User2`: “角色”和“简单角色”共用的第二层 User 指令。
    *   **角色名单:**
        *   **十 (添加角色):** 创建一个新的复杂“角色”。
        *   **列表:** 显示所有已创建的角色。
        *   **✎ (编辑/重命名):** 修改角色名称。
        *   **✕ (删除):** 删除角色及其所有相关数据（设定、记忆、模板）。
        *   **点击角色名称:** 进入该角色的详细设置页面。
    *   **角色详情页:**
        *   **角色设定:** 编写角色的核心设定、性格、背景故事等。AI 会参考这里的内容。
        *   **角色记忆:** 记录角色的经历、知识等。通常由“角色更新大师”自动添加，但也可以手动编辑。
        *   **角色状态 (只读):** 显示由“游戏主持人”等工具更新的最新角色状态信息（如位置、动作、情绪等）。
        *   **Drawing Template:** 编写该角色的 NovelAI 绘图提示词模板（例如外貌、常穿服装的关键词）。“绘图大师”会自动使用。
        *   **导出/导入此角色:** 单独备份或加载某个角色的设定、记忆和模板。

6.  **聊天室设置:**
    *   **通用配置:**
        *   `参考文本字符数`: 设置当使用 `{{参考文本}}` 占位符时，从关联的激活小说中提取多少字符作为上下文。
    *   **聊天室目录:**
        *   **十 (添加聊天室):** 创建新的聊天室。
        *   **列表:** 显示所有聊天室。
        *   **单选按钮:** 选择当前要进入的**活动聊天室**。切换聊天室会加载对应的历史记录和设置。
        *   **✎ (编辑/重命名):** 修改聊天室名称。
        *   **✕ (删除):** 删除聊天室及其所有历史记录和配置。
        *   **点击聊天室名称 (标签):** 进入该聊天室的详细设置页面。
    *   **聊天室详情页 (子菜单):**
        *   **当前聊天室设置:**
            *   `消息记录 (只读)`: 查看当前聊天室的对话历史文本。
            *   `清空消息记录`: 删除当前聊天室的所有消息。**警告：这也会删除所有用户定义的简单角色！**
            *   `最新世界信息 (只读)`: 显示“游戏主持人”提供的最新场景描述/状态。
            *   `扮演规则`: 编写**此聊天室专属**的扮演规则。AI 可通过 `{{扮演规则}}` 占位符获取。
            *   `公共信息`: 编写**此聊天室专属**的公开信息（如世界背景）。AI 可通过 `{{公共信息}}` 占位符获取。
            *   `导出/导入此聊天室`: 单独备份或加载某个聊天室的配置、历史记录、角色和小说关联等。
        *   **聊天室角色:**
            *   勾选框列表，显示所有已创建的“角色”和“简单角色”。
            *   勾选一个“角色”（非简单角色），将其**关联**到当前聊天室。只有关联的角色才能在该聊天室中通过顶部的 👤 按钮进行控制和交互。
            *   “简单角色”默认全部关联且不可取消。
        *   **聊天室小说:**
            *   勾选框列表，显示所有已在“剧情模式”中添加的小说。
            *   勾选一本小说，将其**关联**到当前聊天室。只有关联的小说才能在该聊天室的阅读界面书架中看到，并用于 `{{参考文本}}`。

7.  **工具列表:**
    *   点击工具名称（绘图大师、游戏主持人、写作大师、角色更新大师）进入各自的详细设置页面。
    *   **工具详情页:**
        *   `启用` 复选框: 控制该工具是否运行。
        *   `显示输出` 复选框: 控制该工具的 AI 回应是否在聊天界面中可见（即使不显示，工具本身仍然会运行并可能影响其他部分，如更新状态）。
        *   `Response Schema (JSON)`: 定义该工具期望 AI 返回的 JSON 结构。
        *   `Response Schema Parser (JS)`: 编写 JS 代码解析该工具的 JSON 输出。
        *   `User2`: 该工具专用的第二层 User 指令。

8.  **剧情模式 (管理小说):**
    *   **十 添加小说 (从剪贴板):** 将剪贴板中的长文本导入为一个新的小说。会要求输入小说名称。
    *   **列表:** 显示所有已导入的小说。
    *   **✎ (编辑/重命名):** 修改小说名称。
    *   **✕ (删除):** 删除小说及其处理后的文件。

**六、 聊天界面交互**

1.  **顶部 👤 (角色按钮):**
    *   点击展开/收起角色列表。列表仅显示**当前聊天室已关联**的角色和简单角色。
    *   **角色按钮 (如 "张", "李", "📏"):**
        *   **单击:** 展开或收起该角色的状态控制按钮。
        *   **长按 (对“角色”):** 快速跳转到该角色的详细设置页面。
        *   **长按 (对非“管理员”的“简单角色”):** 删除该简单角色（会从所有地方移除）。
    *   **状态控制按钮 (默/活/用/更):**
        *   `默 (默认)`: 角色不主动响应，状态也不会被主要考虑。
        *   `活 (活跃)`: AI 会在适当时自动控制该角色进行响应。
        *   `用 (用户控制)`: AI 不会自动控制该角色，当轮到该角色行动时，系统会暂停 (◼ -> ▶)，并创建一个属于该角色的空消息框让用户手动输入。
        *   `更 (更新)`: (仅限“角色”) 手动触发“角色更新大师”对该角色进行一次设定和记忆的更新。
        *   点击状态按钮可切换状态。按钮背景变绿表示当前选定状态。

2.  **消息交互:**
    *   **角色名小按钮 (消息气泡上方):** 点击可展开或收起该条消息的操作按钮。
    *   **消息操作按钮 (展开后可见):**
        *   **✏️ (编辑):**
            *   对用户消息或 AI 的“格式化”文本消息：进入编辑模式，修改后点击外部或按 Enter 保存。
            *   对 AI 的“原始 JSON”消息：进入编辑模式，修改 JSON 文本后点击外部或按 Enter 保存。**保存时会尝试重新解析 JSON 并更新显示。**
            *   **注意:** “游戏主持人”的非时间视图、“绘图大师”的图片消息无法直接编辑。
        *   **🔄 (切换原始/格式化):** (仅 AI 消息) 在查看 AI 返回的原始 JSON 文本和经过解析器处理后的格式化文本之间切换。
        *   **💾 (保存更新):** (仅“角色更新大师”消息) 点击后，将消息中显示的“更新后记忆”和“更新后设定”内容，覆盖到对应角色的配置中。
        *   **🖼️ (设为背景/下载):** (仅“绘图大师”生成的图片消息)
            *   **单击:** 将该图片设置为聊天界面的背景图。
            *   **长按:** 下载该图片文件。
        *   **✕ (删除):**
            *   **单击:** 删除**单条**消息。
            *   **长按:** 删除**此条消息及其下方所有**的消息。

3.  **游戏主持人 (🎲) 消息:**
    *   包含三个小按钮 (🕒 时间, 📍 地点, 👤 角色)。
    *   点击不同按钮，下方内容区域会切换显示不同的信息摘要（时间流逝/行动结果、地点与角色相对位置、具体角色的详细状态）。
    *   只有在 🕒 (时间) 视图下，才能编辑行动结果描述。

4.  **绘图大师 (🎨) 消息:**
    *   通常显示为一张图片。
    *   点击图片可全屏放大查看。再次点击退出放大。
    *   通过消息操作按钮 🖼️ 可设为背景或下载。

**七、 小说阅读界面 (通过 📖 图标进入)**

1.  **主内容区域:** 显示当前选定的小说内容。滚动会被记忆。章节标题会以粗体显示。
2.  **顶部 📚 (书架按钮):** 点击打开书架页面。
3.  **顶部 ☰ (目录按钮):** 点击打开当前小说的目录页面。
4.  **书架页面 (📚):**
    *   列表显示**当前聊天室已关联**的所有小说。
    *   **单选按钮:** 选择您想在主内容区域**阅读**的小说。选择后会自动加载内容。
    *   **复选框:** **激活**或**取消激活**该小说。只有**激活**的小说内容才会被 `{{参考文本}}` 占位符提取。您可以同时激活多本小说。
    *   **右上角 ✕:** 关闭书架页面。
5.  **目录页面 (☰):**
    *   列表显示当前阅读小说的所有章节（包括自动生成的）。
    *   点击章节标题，主内容区域会自动滚动到该章节的开头。
    *   **右上角 ✕:** 关闭目录页面。

**八、 常见使用流程示例**

*   **简单角色扮演:**
    1.  配置好 API 密钥和模型。
    2.  创建聊天室。
    3.  创建“角色” A 和 B。
    4.  进入聊天室设置 -> 聊天室角色，勾选 A 和 B。
    5.  回到聊天界面，点击 👤 按钮。
    6.  点击角色 A 的按钮，选择 `活` 状态。
    7.  点击角色 B 的按钮，选择 `活` 状态。
    8.  确保 AI 运行 (◼)。
    9.  长按 📏 添加管理员消息，输入开场白或指令。
    10. AI 会自动驱动角色 A 和 B 进行对话。

*   **使用小说上下文:**
    1.  在“剧情模式”中添加一本小说。
    2.  创建聊天室。
    3.  进入聊天室设置 -> 聊天室小说，勾选添加的小说。
    4.  在 API 设置或角色设定等的指令中使用 `{{参考文本}}` 占位符。
    5.  进入小说阅读界面 (📖)。
    6.  打开书架 (📚)，确保目标小说**已被选中 (单选按钮)** 且**已被激活 (复选框)**。
    7.  关闭书架，滚动小说内容到您希望 AI 参考的部分。
    8.  回到聊天界面，发送包含 `{{参考文本}}` 指令的消息，AI 会获取您刚才浏览位置附近的小说内容作为上下文。

*   **请求绘图:**
    1.  在“绘图设置”中配置 NovelAI API 密钥和参数。
    2.  在“工具列表”中启用“绘图大师”。
    3.  (可选) 在角色详情中为角色设置“绘图模板”。
    4.  在聊天中，让角色描述一个场景，或者让“游戏主持人”生成场景描述。
    5.  “绘图大师”会自动运行（如果启用），解析描述，生成提示词，调用 NovelAI。
    6.  图片会出现在聊天界面中。

**九、 注意事项与提示**

*   **自动保存:** 大部分设置更改会通过后端自动保存到 `config.json`。聊天记录需要在切换聊天室或主动导出时保存。小说内容在添加时保存。
*   **占位符是关键:** 熟练运用 `{{...}}` 占位符是发挥“绳墨”强大功能的关键。
*   **解析器:** JSON Schema 和解析器是实现结构化输出和自动化流程的核心，需要一定的编程知识。如果不需要，可以将 Schema 和 Parser 留空。
*   **工具依赖:** 某些工具（如角色更新大师）可能依赖其他工具（如游戏主持人）的输出。确保相关工具都已启用并正确配置。
*   **性能:** 大量聊天记录或非常复杂的上下文（如超长参考文本）可能会影响性能或超出 AI 的处理能力。
*   **排错:** 如果遇到问题，先检查设置（API密钥、模型选择、工具启用状态），然后查看“报错日志”。

---

希望这份详细的指南能帮助您快速上手并充分利用“绳墨”的各项功能！祝您使用愉快！# -
