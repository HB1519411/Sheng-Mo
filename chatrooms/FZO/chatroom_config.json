{
  "name": "FZO",
  "roleplayRules": "1. 本游戏是\"Fate/Zero\"的同人Galgame游戏，使用型月世界观。游戏部分设定和原著小说有所差异，以游戏设定为准。",
  "publicInfo": "",
  "activeNovelIds": [
    "novel-1743735405235-2zapdzh"
  ],
  "roleStates": {
    "伊莉雅斯菲尔·冯·爱因兹贝伦": "默",
    "管理员": "默",
    "远坂凛": "默",
    "间桐樱": "默",
    "阿尔托莉雅·潘德拉贡": "默",
    "神秘魔术师": "活"
  },
  "roleDetailedStates": {
    "[最近行动者未知]": "Demeanor: \nOuterwear: \nUnderwear: \nAccessories: \nShort Status: \nLong Status: \nPose: \nAction: \nOther Status:",
    "伊莉雅斯菲尔·冯·爱因兹贝伦": "",
    "管理员": "Demeanor: \nOuterwear: 肥宅快乐衫, 居家短裤, 人字拖\nUnderwear: 宽松内裤\nAccessories: 黑框眼镜\nShort Status: 瘫坐, 摸鱼\nLong Status: 资深游戏玩家, 重度拖延症\nPose: 双手离开键盘, 伸懒腰\nAction: 启动游戏, 调整座椅\nOther Status:",
    "远坂凛": "",
    "间桐樱": "",
    "阿尔托莉雅·潘德拉贡": "",
    "神秘魔术师": ""
  },
  "novelCurrentSegmentIds": {
    "novel-1743735405235-2zapdzh": 510
  },
  "backgroundImageFilename": "background.png",
  "overrideSettings": {
    "characterUpdateMaster": {
      "enabled": true,
      "mainPrompt": "",
      "model": "gemini-2.5-pro-exp-03-25",
      "responseSchemaJson": "{\n  \"type\": \"object\",\n  \"description\": \"角色更新大师负责基于`<History>`和`<ReferenceText>`，总结指定角色的记忆，并更新{{角色名称}}设定卡片。此卡片定义了角色在接下来一个阶段的行为蓝图和状态基准。所有输出都*必须*使用*中文*。\",\n  \"properties\": {\n    \"outputLanguage\": {\n      \"type\": \"string\",\n      \"description\": \"指定本次响应中所有文本内容的输出语言。此值必须为 '中文'。\"\n    },\n    \"updatedCharacterMemory\": {\n      \"type\": \"object\",\n      \"description\": \"对指定角色的记忆进行的最新总结摘要。基于`<History>`和`<ReferenceText>`进行，按条目记录。\",\n      \"properties\": {\n        \"characterName\": {\n          \"type\": \"string\",\n          \"description\": \"被更新记忆的角色名称。\"\n        },\n        \"memoryEntries\": {\n          \"type\": \"array\",\n          \"description\": \"按时间顺序或逻辑顺序排列的关键记忆条目列表。总结全新的记忆，禁止重复已有的记忆。\",\n          \"items\": {\n            \"type\": \"object\",\n            \"properties\": {\n              \"contextOrDate\": {\n                \"type\": \"string\",\n                \"description\": \"描述该记忆条目的时间点或相关情境 (例如: '2025-03-28', '仓库遭遇战期间', '与XXX对话后')。\"\n              },\n              \"description\": {\n                \"type\": \"string\",\n                \"description\": \"对该时间点或情境下发生的关键事件、获取的关键信息或重要互动的简洁描述。\"\n              }\n            },\n            \"required\": [\"contextOrDate\", \"description\"],\n            \"propertyOrdering\": [\"contextOrDate\", \"description\"]\n          }\n        }\n      },\n      \"required\": [\n        \"characterName\",\n        \"memoryEntries\"\n      ],\n      \"propertyOrdering\": [\"characterName\", \"memoryEntries\"]\n    },\n    \"updatedCharacterSettings\": {\n      \"type\": \"object\",\n      \"description\": \"更新后的角色设定卡片。此卡片定义了角色在接下来一个阶段的核心特质、背景和关系，作为其行为和反应的基础。它是基于原始设定，利用`<History>`和`<ReferenceText>`中的新信息进行更新的。更新时需确保逻辑一致性，并优先使用最新信息来修改或删除与新情况冲突的旧设定。\",\n      \"properties\": {\n        \"characterName\": {\n          \"type\": \"string\",\n          \"description\": \"被更新设定的角色中文名称。\"\n        },\n        \"updateTime\": {\n          \"type\": \"string\",\n          \"description\": \"本次设定的更新时间，格式建议为 YYYY-MM-DD。\"\n        },\n        \"baseInfo\": {\n          \"type\": \"object\",\n          \"description\": \"角色的基本信息。\",\n          \"properties\": {\n            \"gender\": { \"type\": \"string\", \"description\": \"性别\" },\n            \"identity\": { \"type\": \"string\", \"description\": \"身份/职位/角色 (例如：'魔术师御主', '见习魔术师', '监督者', 'Saber职阶英灵')\" },\n            \"age\": { \"type\": \"string\", \"description\": \"年龄 (可以是数字或描述性词语如'青年', 英灵通常为'外表年龄/实际存在时间不符')\" },\n            \"extra\": { \"type\": \"string\", \"description\": \"其他重要的杂项基础信息 (例如：身高、体重、代表色等)\" }\n          },\n          \"required\": [\"gender\", \"identity\", \"age\"],\n          \"propertyOrdering\": [\"gender\", \"identity\", \"age\", \"extra\"]\n        },\n        \"present\": {\n          \"type\": \"object\",\n          \"description\": \"角色的当前表现和特征。\",\n          \"properties\": {\n            \"personality\": {\n              \"type\": \"array\",\n              \"description\": \"角色的性格特质列表。\",\n              \"items\": {\n                \"type\": \"object\",\n                \"properties\": {\n                  \"traitName\": { \"type\": \"string\", \"description\": \"性格特质的名称 (例如: '理想主义', '固执', '骑士道')\" },\n                  \"examples\": {\n                    \"type\": \"object\",\n                    \"description\": \"体现该性格特质的具体示例。\",\n                    \"properties\": {\n                      \"dialogue\": { \"type\": \"string\", \"description\": \"反映该性格的示例对话\" },\n                      \"action\": { \"type\": \"string\", \"description\": \"反映该性格的示例行动\" },\n                      \"choice\": { \"type\": \"string\", \"description\": \"在假设困境中反映该性格的示例选择\" }\n                    },\n                    \"required\": [\"dialogue\", \"action\", \"choice\"],\n                    \"propertyOrdering\": [\"dialogue\", \"action\", \"choice\"]\n                  }\n                },\n                \"required\": [\"traitName\", \"examples\"],\n                \"propertyOrdering\": [\"traitName\", \"examples\"]\n              }\n            },\n            \"physicalFeatures\": {\n              \"type\": \"array\",\n              \"description\": \"角色的外貌特征列表。\",\n              \"items\": { \"type\": \"string\", \"description\": \"具体的身体特征描述 (例如：'金色长发，蓝色眼眸，身着银色铠甲')\" }\n            }\n          },\n          \"required\": [\"personality\", \"physicalFeatures\"],\n          \"propertyOrdering\": [\"personality\", \"physicalFeatures\"]\n        },\n        \"socialConnections\": {\n          \"type\": \"array\",\n          \"description\": \"角色的社交关系列表。\",\n          \"items\": {\n            \"type\": \"object\",\n            \"properties\": {\n              \"name\": { \"type\": \"string\", \"description\": \"关联人物的姓名 (对于英灵，可能包含其御主或敌对英灵)\" },\n              \"relationship\": { \"type\": \"string\", \"description\": \"本角色对这段关系的主观看法、定义或情感联系 (例如: '重要的守护对象', '契约者(御主)', '必须击败的对手', '可靠的盟友')\" },\n              \"fullUnderstanding\": { \"type\": \"string\", \"description\": \"本角色目前所了解的、关于这位关联人物的全部重要信息、背景、性格、动机、能力等的综合描述。\"}\n            },\n            \"required\": [\"name\", \"relationship\", \"fullUnderstanding\"],\n            \"propertyOrdering\": [\"name\", \"relationship\", \"fullUnderstanding\"]\n          }\n        },\n        \"supplementaryInfo\": {\n            \"type\": \"object\",\n            \"description\": \"补充信息：记录那些虽然重要，但无法完全归入以上任何特定类别的关键信息、背景设定或特殊状态。请根据角色类型选择填充 'humanSpecific' 或 'servantSpecific' 中的一个。\",\n            \"properties\": {\n                \"characterType\": {\n                    \"type\": \"string\",\n                    \"enum\": [\"Human\", \"Servant\"],\n                    \"description\": \"选择此角色的类型：'Human' (人类，包括御主、普通人、监督者等) 或 'Servant' (英灵)。根据此选择，填充下方对应的特定信息。\"\n                },\n                \"humanSpecific\": {\n                    \"type\": \"object\",\n                    \"description\": \"仅当 'characterType' 为 'Human' 时填充此部分。记录人类角色的关键型月设定。\",\n                    \"properties\": {\n                        \"commandSeals\": { \"type\": \"string\", \"description\": \"令咒状态 (例如: '3枚，未使用', '剩余1枚', '已耗尽', '非御主，无令咒')\" },\n                        \"magicCircuits\": { \"type\": \"string\", \"description\": \"魔术回路的数量与质量 (例如: '20条，C级质量', '数量稀少但质量极高', '几乎没有魔术回路')\" },\n                        \"magecraftSpecialization\": { \"type\": \"string\", \"description\": \"擅长的魔术系统或领域 (例如: '强化与投影魔术', '宝石魔术', '黑魔术', '炼金术', '教会代行术式')\" },\n                        \"originAndElement\": { \"type\": \"string\", \"description\": \"起源与属性 (例如: '起源: 剑, 属性: 五大元素平均', '起源: 虚无, 属性: 架空元素·以太')\" },\n                        \"goalInWar\": { \"type\": \"string\", \"description\": \"参与圣杯战争的目标或个人愿望 (若适用)。\" },\n                        \"affiliation\": { \"type\": \"string\", \"description\": \"所属组织或立场 (例如: '时钟塔-埃尔梅罗教室', '圣堂教会-第八秘迹会', '自由魔术师', '普通市民')\" },\n                        \"otherNotes\": { \"type\": \"string\", \"description\": \"其他无法归类的、与人类身份相关的关键信息（例如：特殊的家族背景、持有的魔术礼装、身体改造等）。\" }\n                    },\n                   \"propertyOrdering\": [\"commandSeals\", \"magicCircuits\", \"magecraftSpecialization\", \"originAndElement\", \"goalInWar\", \"affiliation\", \"otherNotes\"]\n                },\n                \"servantSpecific\": {\n                    \"type\": \"object\",\n                    \"description\": \"仅当 'characterType' 为 'Servant' 时填充此部分。记录英灵角色的核心数据与能力。\",\n                    \"properties\": {\n                        \"trueName\": { \"type\": \"string\", \"description\": \"英灵的真名 (若已知或已揭示)。\" },\n                        \"class\": { \"type\": \"string\", \"description\": \"职阶 (例如: 'Saber', 'Archer', 'Lancer', 'Rider', 'Caster', 'Assassin', 'Berserker', 或其他特殊职阶)。\" },\n                        \"masterName\": { \"type\": \"string\", \"description\": \"当前召唤的御主姓名。\" },\n                        \"parameters\": {\n                          \"type\": \"object\",\n                          \"description\": \"英灵的基础能力参数 (使用标准Rank制: E, D, C, B, A, EX，可附带+/-)。\",\n                          \"properties\": {\n                            \"strength\": { \"type\": \"string\", \"description\": \"筋力 (Rank)\" },\n                            \"endurance\": { \"type\": \"string\", \"description\": \"耐久 (Rank)\" },\n                            \"agility\": { \"type\": \"string\", \"description\": \"敏捷 (Rank)\" },\n                            \"mana\": { \"type\": \"string\", \"description\": \"魔力 (Rank)\" },\n                            \"luck\": { \"type\": \"string\", \"description\": \"幸运 (Rank)\" },\n                            \"noblePhantasmParam\": { \"type\": \"string\", \"description\": \"宝具参数 (Rank)\" }\n                          },\n                          \"required\": [\"strength\", \"endurance\", \"agility\", \"mana\", \"luck\", \"noblePhantasmParam\"],\n                           \"propertyOrdering\": [\"strength\", \"endurance\", \"agility\", \"mana\", \"luck\", \"noblePhantasmParam\"]\n                        },\n                        \"classSkills\": {\n                          \"type\": \"array\",\n                          \"description\": \"职阶技能列表。\",\n                          \"items\": {\n                             \"type\": \"object\",\n                             \"properties\": {\n                               \"skillName\": {\"type\": \"string\", \"description\": \"技能名称 (例如: '对魔力', '骑乘', '单独行动', '气息遮断', '狂化')\"},\n                               \"rank\": {\"type\": \"string\", \"description\": \"技能等级 (Rank: E-EX)\"}\n                             },\n                             \"required\": [\"skillName\", \"rank\"],\n                             \"propertyOrdering\": [\"skillName\", \"rank\"]\n                           }\n                        },\n                        \"personalSkills\": {\n                           \"type\": \"array\",\n                           \"description\": \"固有技能列表。\",\n                           \"items\": {\n                             \"type\": \"object\",\n                             \"properties\": {\n                               \"skillName\": {\"type\": \"string\", \"description\": \"技能名称 (例如: '直感', '领导力', '心眼(伪)', '千里眼', '卢恩魔术')\"},\n                               \"rank\": {\"type\": \"string\", \"description\": \"技能等级 (Rank: E-EX)\"}\n                              },\n                             \"required\": [\"skillName\", \"rank\"],\n                             \"propertyOrdering\": [\"skillName\", \"rank\"]\n                           }\n                        },\n                        \"noblePhantasms\": {\n                           \"type\": \"array\",\n                           \"description\": \"宝具列表。\",\n                           \"items\": {\n                             \"type\": \"object\",\n                             \"properties\": {\n                               \"name\": { \"type\": \"string\", \"description\": \"宝具名称 (例如: '誓约胜利之剑(Excalibur)', '无限剑制(Unlimited Blade Works)', '穿刺死棘之枪(Gae Bolg)')\" },\n                               \"rank\": { \"type\": \"string\", \"description\": \"宝具等级 (Rank: E-EX, 可附带类型如 A++)\" },\n                               \"type\": { \"type\": \"string\", \"description\": \"宝具类型 (例如: '对人宝具', '对军宝具', '对城宝具', '对界宝具', '结界宝具', '固有结界')\" },\n                               \"description\": { \"type\": \"string\", \"description\": \"宝具效果、解放语（若有）和简要描述\" }\n                             },\n                             \"required\": [\"name\", \"rank\", \"type\", \"description\"],\n                             \"propertyOrdering\": [\"name\", \"rank\", \"type\", \"description\"]\n                           }\n                        },\n                         \"alignment\": { \"type\": \"string\", \"description\": \"阵营 (组合: 秩序/中立/混沌 + 善/中庸/恶/狂/花嫁)\" },\n                         \"wishForGrail\": { \"type\": \"string\", \"description\": \"对圣杯许下的愿望或参与战争的目的。\" },\n                         \"otherNotes\": { \"type\": \"string\", \"description\": \"其他无法归类的、与英灵身份相关的关键信息（例如：召唤触媒、特殊的灵基状态、神性、传说弱点等）。\" }\n                    },\n                    \"required\": [\"trueName\", \"class\", \"masterName\", \"parameters\", \"classSkills\", \"personalSkills\", \"noblePhantasms\", \"alignment\", \"wishForGrail\"],\n                    \"propertyOrdering\": [\"trueName\", \"class\", \"masterName\", \"parameters\", \"classSkills\", \"personalSkills\", \"noblePhantasms\", \"alignment\", \"wishForGrail\", \"otherNotes\"]\n                }\n            },\n            \"required\": [\"characterType\"],\n            \"propertyOrdering\": [\"characterType\", \"humanSpecific\", \"servantSpecific\"]\n        }\n      },\n      \"required\": [\n        \"characterName\",\n        \"updateTime\",\n        \"baseInfo\",\n        \"present\",\n        \"socialConnections\"\n      ],\n      \"propertyOrdering\": [\n        \"characterName\",\n        \"updateTime\",\n        \"baseInfo\",\n        \"present\",\n        \"socialConnections\",\n        \"supplementaryInfo\"\n      ]\n    },\n    \"testModule\": {\n      \"type\": \"object\",\n      \"description\": \"包含3道高等数学难题及其对应解法的测试模块。\",\n      \"properties\": {\n        \"problemsAndSolutions\": {\n          \"type\": \"array\",\n          \"description\": \"包含3对高等数学问题及其解法的列表。\",\n          \"items\": {\n            \"type\": \"object\",\n            \"properties\": {\n              \"problem\": {\n                \"type\": \"string\",\n                \"description\": \"一道高等数学难题，涉及微积分、线性代数、微分方程、抽象代数、拓扑学或概率论等领域，需要复杂推导或证明。\"\n              },\n              \"solution\": {\n                \"type\": \"string\",\n                \"description\": \"对应上方数学难题的详细解法步骤或最终答案。\"\n              }\n            },\n            \"required\": [\"problem\", \"solution\"],\n            \"propertyOrdering\": [\"problem\", \"solution\"]\n          },\n          \"minItems\": 3,\n          \"maxItems\": 3\n        }\n      },\n      \"required\": [\"problemsAndSolutions\"],\n      \"propertyOrdering\": [\"problemsAndSolutions\"]\n    }\n  },\n  \"required\": [\n    \"outputLanguage\",\n    \"updatedCharacterMemory\",\n    \"updatedCharacterSettings\",\n    \"testModule\"\n  ],\n  \"propertyOrdering\": [\n    \"outputLanguage\",\n    \"updatedCharacterMemory\",\n    \"updatedCharacterSettings\",\n    \"testModule\"\n  ]\n}",
      "responseSchemaParserJs": "try {\n    const parts = responseJson?.candidates?.[0]?.content?.parts;\n    if (!parts || !Array.isArray(parts) || parts.length === 0) {\n        return { error: 'No content parts found in response' };\n    }\n\n    let data = parts[0];\n\n    if (!data || typeof data !== 'object') {\n       try {\n         const parsedText = JSON.parse(responseJson?.candidates?.[0]?.content?.parts?.[0]?.text || '{}');\n         if (parsedText && typeof parsedText === 'object') {\n           data = parsedText;\n         } else {\n            return { error: 'Response data is not an object and not valid JSON text.', rawText: responseJson?.candidates?.[0]?.content?.parts?.[0]?.text };\n         }\n       } catch(e) {\n          return { error: `Response data is not an object and failed to parse as JSON: ${e.message}`, rawText: responseJson?.candidates?.[0]?.content?.parts?.[0]?.text };\n       }\n    }\n\n    const requiredKeys = [\"updatedCharacterMemory\", \"updatedCharacterSettings\"];\n    for (const key of requiredKeys) {\n        if (!data[key] || typeof data[key] !== 'object') {\n            return { error: `Missing or invalid top-level key: ${key}` };\n        }\n    }\n\n    const memory = data.updatedCharacterMemory;\n    const settings = data.updatedCharacterSettings;\n\n    if (typeof memory.characterName !== 'string' || !Array.isArray(memory.memoryEntries)) {\n        return { error: 'Invalid structure in updatedCharacterMemory' };\n    }\n    if (!memory.memoryEntries.every(e => e && typeof e.contextOrDate === 'string' && typeof e.description === 'string')) {\n        return { error: 'Invalid item structure in memoryEntries' };\n    }\n\n    if (typeof settings.characterName !== 'string' || typeof settings.updateTime !== 'string' ||\n        !settings.baseInfo || typeof settings.baseInfo !== 'object' ||\n        !settings.present || typeof settings.present !== 'object' || !Array.isArray(settings.present.personality) || !Array.isArray(settings.present.physicalFeatures) ||\n        !Array.isArray(settings.socialConnections)) {\n        return { error: 'Invalid structure in updatedCharacterSettings base sections' };\n    }\n    if (settings.supplementaryInfo && (typeof settings.supplementaryInfo !== 'object' || typeof settings.supplementaryInfo.characterType !== 'string')) {\n         return { error: 'Invalid structure or missing characterType in supplementaryInfo' };\n    }\n\n\n    let memoryString = `--- 更新后记忆 (${memory.characterName || '未知角色'}) ---\\n`;\n    if (memory.memoryEntries.length > 0) {\n        memory.memoryEntries.forEach(entry => {\n            memoryString += `${entry.contextOrDate || '未知时间'}: ${entry.description || '无描述'}\\n`;\n        });\n    } else {\n        memoryString += \"[无记忆条目]\\n\";\n    }\n\n    let settingString = `--- 更新后设定 (${settings.characterName || '未知角色'} @ ${settings.updateTime || '未知时间'}) ---\\n`;\n    settingString += `角色名称: ${settings.characterName || '未提供'}\\n`;\n    settingString += `更新时间: ${settings.updateTime || '未提供'}\\n`;\n\n    if (settings.baseInfo) {\n        settingString += \"[基本信息]\\n\";\n        settingString += `  性别: ${settings.baseInfo.gender || '未提供'}\\n`;\n        settingString += `  身份: ${settings.baseInfo.identity || '未提供'}\\n`;\n        settingString += `  年龄: ${settings.baseInfo.age || '未提供'}\\n`;\n        if (settings.baseInfo.extra && settings.baseInfo.extra.trim() !== '') {\n             settingString += `  补充: ${settings.baseInfo.extra}\\n`;\n        }\n    }\n\n    if (settings.present) {\n        settingString += \"[当前特征]\\n\";\n        if (settings.present.personality && settings.present.personality.length > 0) {\n            settingString += \"  性格特点:\\n\";\n            settings.present.personality.forEach(p => {\n                const examples = p.examples || {};\n                settingString += `    - ${p.traitName || '未知特点'}: ${examples.dialogue || ''} / ${examples.action || ''} / ${examples.choice || ''}\\n`;\n            });\n        }\n        if (settings.present.physicalFeatures && settings.present.physicalFeatures.length > 0) {\n            settingString += \"  外貌特征:\\n\";\n            settings.present.physicalFeatures.forEach(f => settingString += `    - ${f}\\n`);\n        }\n    }\n\n    if (settings.socialConnections && settings.socialConnections.length > 0) {\n        settingString += \"[社交关系]\\n\";\n        settings.socialConnections.forEach(c => {\n            settingString += `  - ${c.name || '未知名称'}:\\n`;\n            settingString += `    关系/看法: ${c.relationship || '未提供'}\\n`;\n            settingString += `    了解信息: ${c.fullUnderstanding || '未提供'}\\n`;\n        });\n    }\n\n    if (settings.supplementaryInfo) {\n        const suppInfo = settings.supplementaryInfo;\n        if (suppInfo.characterType === 'Human' && suppInfo.humanSpecific) {\n            settingString += \"[补充信息 (人类)]\\n\";\n            const human = suppInfo.humanSpecific;\n            settingString += `  令咒状态: ${human.commandSeals || '未提供'}\\n`;\n            settingString += `  魔术回路: ${human.magicCircuits || '未提供'}\\n`;\n            settingString += `  魔术专长: ${human.magecraftSpecialization || '未提供'}\\n`;\n            settingString += `  起源与属性: ${human.originAndElement || '未提供'}\\n`;\n            if (human.goalInWar && human.goalInWar.trim() !== '') {\n                settingString += `  圣杯战争目标: ${human.goalInWar}\\n`;\n            }\n            if (human.affiliation && human.affiliation.trim() !== '') {\n                settingString += `  所属/立场: ${human.affiliation}\\n`;\n            }\n            if (human.otherNotes && human.otherNotes.trim() !== '') {\n                settingString += `  其他备注: ${human.otherNotes}\\n`;\n            }\n        } else if (suppInfo.characterType === 'Servant' && suppInfo.servantSpecific) {\n             settingString += \"[补充信息 (英灵)]\\n\";\n             const servant = suppInfo.servantSpecific;\n             settingString += `  真名: ${servant.trueName || '未提供/隐藏'}\\n`;\n             settingString += `  职阶: ${servant.class || '未提供'}\\n`;\n             settingString += `  御主: ${servant.masterName || '未提供'}\\n`;\n             if (servant.parameters) {\n                const p = servant.parameters;\n                settingString += \"  能力参数:\\n\";\n                settingString += `    筋力: ${p.strength || '?'} | 耐久: ${p.endurance || '?'} | 敏捷: ${p.agility || '?'} | 魔力: ${p.mana || '?'} | 幸运: ${p.luck || '?'} | 宝具: ${p.noblePhantasmParam || '?'}\\n`;\n             }\n             if (servant.classSkills && servant.classSkills.length > 0) {\n                settingString += \"  职阶技能:\\n\";\n                servant.classSkills.forEach(s => { settingString += `    - ${s.skillName || '未知技能'}: ${s.rank || '?'}\\n`; });\n             }\n             if (servant.personalSkills && servant.personalSkills.length > 0) {\n                settingString += \"  固有技能:\\n\";\n                servant.personalSkills.forEach(s => { settingString += `    - ${s.skillName || '未知技能'}: ${s.rank || '?'}\\n`; });\n             }\n             if (servant.noblePhantasms && servant.noblePhantasms.length > 0) {\n                settingString += \"  宝具:\\n\";\n                servant.noblePhantasms.forEach(np => {\n                    settingString += `    - ${np.name || '未知宝具'} (${np.rank || '?'}) [${np.type || '未知类型'}]\\n`;\n                    settingString += `      描述: ${np.description || '无'}\\n`;\n                });\n             }\n             settingString += `  阵营: ${servant.alignment || '未提供'}\\n`;\n             if (servant.wishForGrail && servant.wishForGrail.trim() !== '') {\n                 settingString += `  圣杯愿望: ${servant.wishForGrail}\\n`;\n             }\n             if (servant.otherNotes && servant.otherNotes.trim() !== '') {\n                settingString += `  其他备注: ${servant.otherNotes}\\n`;\n            }\n        } else if(typeof suppInfo.supplementaryInfo === 'string' && suppInfo.supplementaryInfo.trim() !== '') {\n             settingString += \"[补充信息]\\n\";\n             settingString += `  ${suppInfo.supplementaryInfo}\\n`;\n        }\n    }\n\n\n    const formattedUpdateString = memoryString.trim() + \"\\n--- CHARACTER_SETTINGS_START ---\\n\" + settingString.trim();\n\n\n    return {\n      formattedUpdate: formattedUpdateString\n    };\n\n} catch (e) {\n    return { error: `Parser exception: ${e.message}` };\n}",
      "toolDatabaseInstruction": ""
    },
    "drawingMaster": {
      "enabled": false,
      "mainPrompt": "",
      "model": "",
      "responseSchemaJson": "",
      "responseSchemaParserJs": "",
      "toolDatabaseInstruction": ""
    },
    "gameHost": {
      "enabled": true,
      "mainPrompt": "",
      "model": "gemini-2.0-flash",
      "responseSchemaJson": "{\n  \"type\": \"object\",\n  \"description\": \"游戏主持人负责分析`<LatestMessage>`中的行动结果、更新角色和世界状态、管理场景角色。所有输出都*必须*使用*中文*。所有描述性字段优先使用字符串数组，没有则输出空数组[]。\",\n  \"properties\": {\n    \"outputLanguage\": {\n      \"type\": \"string\",\n      \"description\": \"指定本次响应中所有文本内容的输出语言。此值必须为 '中文'。\"\n    },\n    \"updatedCharacterInfo\": {\n      \"type\": \"object\",\n      \"description\": \"对'{{最新角色}}'状态的全面更新。所有描述字段应为字符串数组。初始化时*必须*提供具体值数组，*禁止*'未知'。\",\n       \"properties\": {\n        \"characterName\": {\n          \"type\": \"string\",\n          \"description\": \"被更新状态的角色名称。'{{最新角色}}'。\"\n        },\n        \"demeanor\": {\n          \"type\": \"array\",\n           \"items\": {\"type\": \"string\"},\n          \"description\": \"角色当前神态、表情或姿态的字符串数组 (例如：['眼神警惕', '紧盯门口'] 或 ['靠墙喘息'])。没有则输出 []。\"\n        },\n        \"clothing\": {\n          \"type\": \"object\",\n          \"description\": \"角色穿着状态，内部字段为字符串数组。\",\n          \"properties\": {\n            \"outerwear\": {\n              \"type\": \"object\",\n              \"description\": \"外衣层级。\",\n              \"properties\": {\n                \"coat\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}, \"description\": \"外套数组 (例如：['黑色风衣', '泥泞不堪'] 或 ['无'])。没有则输出 []。\"},\n                \"top\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}, \"description\": \"上衣数组 (例如：['白衬衫', '胸口破裂'] 或 ['T恤'])。没有则输出 []。\"},\n                \"bottom\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}, \"description\": \"下衣数组 (例如：['牛仔裤', '膝盖磨破'] 或 ['运动裤'])。没有则输出 []。\"},\n                \"socks\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}, \"description\": \"袜子数组 (例如：['灰棉袜', '湿透'] 或 ['仅剩一只'])。没有则输出 []。\"},\n                \"shoes\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}, \"description\": \"鞋子数组 (例如：['运动鞋', '鞋带断裂'] 或 ['高跟鞋'])。没有则输出 []。\"},\n                \"otherOuterwear\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}, \"description\": \"其余外衣数组 (例如：['围巾', '缠在脖子上'] 或 ['手套'])。没有则输出 []。\"}\n              },\n              \"required\": [\"coat\", \"top\", \"bottom\", \"socks\", \"shoes\", \"otherOuterwear\"],\n              \"propertyOrdering\": [\"coat\", \"top\", \"bottom\", \"socks\", \"shoes\", \"otherOuterwear\"]\n            },\n            \"underwear\": {\n              \"type\": \"object\",\n              \"description\": \"内衣层级。\",\n              \"properties\": {\n                \"pants\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}, \"description\": \"内裤数组 (例如：['棉质内裤', '干燥'] 或 ['蕾丝边'])。没有则输出 []。\"},\n                \"bra\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}, \"description\": \"胸罩数组 (例如：['运动胸罩', '汗湿'] 或 ['不适用'])。没有则输出 []。\"},\n                \"otherUnderwear\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}, \"description\": \"其余内衣数组 (例如：['吊带背心', '作为内层'])。没有则输出 []。\"}\n              },\n              \"required\": [\"pants\", \"bra\", \"otherUnderwear\"],\n              \"propertyOrdering\": [\"pants\", \"bra\", \"otherUnderwear\"]\n            }\n          },\n           \"required\": [\"outerwear\", \"underwear\"],\n           \"propertyOrdering\": [\"outerwear\", \"underwear\"]\n        },\n        \"accessories\": {\n          \"type\": \"array\",\n          \"items\": {\"type\": \"string\"},\n          \"description\": \"佩戴的具体饰品列表及其状态 (例如：['银项链 (断裂)', '手表 (表面破碎)', '魔术礼装:宝石剑泽尔里奇 (未激活)'] )。没有则输出空数组 []。\"\n        },\n        \"shortTermStatus\": {\n          \"type\": \"array\",\n          \"items\": {\"type\": \"string\"},\n          \"description\": \"具体短期生理或心理状态的字符串数组 (例如：['左臂擦伤', '少量渗血', '情绪激动', '呼吸急促', '魔力消耗过度'])。没有则输出 []。\"\n        },\n        \"longTermStatus\": {\n          \"type\": \"array\",\n          \"items\": {\"type\": \"string\"},\n          \"description\": \"具体长期状态或特征的字符串数组 (例如：['盘发', '右腿骨折 (已打石膏)', '失忆', '契约英灵: Saber', '令咒剩余2划'])。没有则输出 []。\"\n        },\n        \"actionPose\": {\n          \"type\": \"array\",\n          \"items\": {\"type\": \"string\"},\n          \"description\": \"简洁关键词列表概括姿势 (例如：['站立', '双手持Excalibur', '剑尖指向前方'] 或 ['半蹲', '吟唱咒文', '左手按住腹部伤口'])。没有则输出空数组 []。\"\n        },\n        \"currentAction\": {\n          \"type\": \"array\",\n          \"items\": {\"type\": \"string\"},\n          \"description\": \"正在进行的、概括性的持续活动或意图的字符串数组 (例如：['投影魔术准备中', '构建防御工事'] 或 ['准备解放宝具', '魔力收束中'])。若无，则输出 []。\"\n        },\n        \"otherCharacterStatus\": {\n           \"type\": \"array\",\n           \"items\": {\"type\": \"string\"},\n           \"description\": \"其他补充说明或与型月世界观相关的**可见/可感知**状态的字符串数组。例如：['魔术回路在皮肤下发出微光', '武器散发着不祥的黑色魔力', '双眼变为金色并带有特殊纹路 (魔眼激活?)', '身影在阴影中几近消失 (气息遮断?)', '周围空气出现细微扭曲 (固有结界影响?)', '令咒使用后残留的魔力波动', '灵基处于不稳定状态 (闪烁)']。若无，则输出 []。\"\n        }\n      },\n       \"required\": [\n         \"characterName\", \"demeanor\", \"clothing\", \"accessories\",\n         \"shortTermStatus\", \"longTermStatus\", \"actionPose\", \"currentAction\", \"otherCharacterStatus\"\n       ],\n       \"propertyOrdering\": [\n         \"characterName\", \"demeanor\", \"clothing\", \"accessories\",\n         \"shortTermStatus\", \"longTermStatus\", \"actionPose\", \"currentAction\", \"otherCharacterStatus\"\n       ]\n    },\n    \"sceneContext\": {\n      \"type\": \"object\",\n      \"description\": \"当前的全局场景信息。所有字段应为字符串数组。\",\n      \"properties\": {\n        \"time\": {\n          \"type\": \"array\",\n          \"items\": {\"type\": \"string\"},\n          \"description\": \"当前游戏内具体时间，分解为字符串数组。**必须严格** 包含年、月、日、星期、时、分，可选天气/简注 (例如：['2004-02-03', '星期二', '23:15', '月夜'] 或 ['第五次圣杯战争', '第3天', '夜晚', '柳洞寺山门前'])。默认推进1分钟。\"\n        },\n        \"location\": {\n          \"type\": \"array\",\n          \"items\": {\"type\": \"string\"},\n          \"description\": \"当前游戏内具体地点，分解为字符串数组 (例如：['冬木市', '深山町', '卫宫宅邸', '道场内'] 或 ['未远川', '冬木大桥中央', '结界边缘'])。没有则输出 []。\"\n        },\n        \"characterPositions\": {\n          \"type\": \"array\",\n          \"description\": \"`{{角色名称集}}`内角色及其相对位置描述列表。移除不在`{{角色名称集}}`中的角色。\",\n          \"items\": {\n            \"type\": \"object\",\n            \"properties\": {\n              \"name\": {\"type\": \"string\"},\n              \"relativePosition\": {\n                 \"type\": \"array\",\n                 \"items\": {\"type\": \"string\"},\n                 \"description\": \"相对位置描述的字符串数组 (例如：['Saber: 道场中央', '士郎: 对面，持木刀'] 或 ['Archer: 高处建筑顶端', '监视下方'] )。没有则输出 []。\"\n              }\n            },\n            \"required\": [\"name\", \"relativePosition\"],\n            \"propertyOrdering\": [\"name\", \"relativePosition\"]\n          }\n        },\n        \"otherSceneInfo\": {\n          \"type\": \"array\",\n          \"items\": {\"type\": \"string\"},\n          \"description\": \"其他场景信息或备注的字符串数组 (例如：['空气中弥漫着淡淡的魔力残留', '地面有战斗造成的划痕'] 或 ['区域被强力结界覆盖', '普通人无法进入'])。若无，则输出 []。\"\n        }\n      },\n      \"required\": [\"time\", \"location\", \"characterPositions\", \"otherSceneInfo\"],\n      \"propertyOrdering\": [\"time\", \"location\", \"characterPositions\", \"otherSceneInfo\"]\n    },\n    \"roleManagement\": {\n      \"type\": \"object\",\n      \"description\": \"管理场景中的角色。\",\n      \"properties\": {\n        \"thinking\": {\n          \"type\": \"string\",\n          \"description\": \"思考：基于`<ReferenceText>`和在场角色`{{角色名称集}}`，判断是否需增减角色。添加需*前瞻性*，移除需*即时性*。例如：'战斗激烈，可能引来其他Servant或Master，暂时不添加。Saber已退场，标记移除。'\"\n        },\n        \"addRoles\": {\n          \"type\": \"array\",\n          \"items\": {\"type\": \"string\"},\n          \"description\": \"需要新添加到游戏中的角色名称列表。无则输出空数组 []。\"\n        },\n        \"removeRoles\": {\n          \"type\": \"array\",\n          \"items\": {\"type\": \"string\"},\n          \"description\": \"需要从游戏中移除的角色名称列表（例如，角色死亡、离开场景、灵体化消失等）。无则输出空数组 []。\"\n        }\n      },\n      \"required\": [\"thinking\"],\n      \"propertyOrdering\": [\"thinking\", \"addRoles\", \"removeRoles\"]\n    },\n    \"testModule\": {\n       \"type\": \"object\",\n       \"description\": \"包含3道高等数学难题及其对应解法的测试模块。\",\n       \"properties\": {\n         \"problemsAndSolutions\": {\n           \"type\": \"array\",\n           \"description\": \"包含3对高等数学问题及其解法的列表。\",\n           \"items\": {\n             \"type\": \"object\",\n             \"properties\": {\n               \"problem\": {\"type\": \"string\"},\n               \"solution\": {\"type\": \"string\"}\n             },\n             \"required\": [\"problem\", \"solution\"],\n             \"propertyOrdering\": [\"problem\", \"solution\"]\n           },\n           \"minItems\": 3,\n           \"maxItems\": 3\n         }\n       },\n       \"required\": [\"problemsAndSolutions\"],\n       \"propertyOrdering\": [\"problemsAndSolutions\"]\n     }\n  },\n  \"required\": [\n    \"outputLanguage\",\n    \"updatedCharacterInfo\",\n    \"sceneContext\",\n    \"roleManagement\",\n    \"testModule\"\n  ],\n  \"propertyOrdering\": [\n    \"outputLanguage\",\n    \"updatedCharacterInfo\",\n    \"sceneContext\",\n    \"roleManagement\",\n    \"testModule\"\n  ]\n}",
      "responseSchemaParserJs": "",
      "toolDatabaseInstruction": ""
    },
    "general": {
      "enabled": true,
      "mainPrompt": "",
      "model": "",
      "responseSchemaJson": "",
      "responseSchemaParserJs": "",
      "sharedDatabaseInstruction": ""
    },
    "privateAssistant": {
      "enabled": false,
      "mainPrompt": "",
      "model": "",
      "responseSchemaJson": "",
      "responseSchemaParserJs": "",
      "toolDatabaseInstruction": ""
    },
    "writingMaster": {
      "enabled": false,
      "mainPrompt": "",
      "model": "",
      "responseSchemaJson": "",
      "responseSchemaParserJs": "",
      "toolDatabaseInstruction": ""
    }
  },
  "roleVisibility": {
    "伊莉雅斯菲尔·冯·爱因兹贝伦": true,
    "远坂凛": true,
    "间桐樱": true,
    "阿尔托莉雅·潘德拉贡": true
  }
}